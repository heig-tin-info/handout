<!DOCTYPE html>
<html  lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style type="text/css">
        p.rubric {
            font-weight: bold;
        }

        p.rubric:hover > a.headerlink {
            visibility: visible;
        }
    </style>
    
      <title>18 Compilation séparée</title>
    
      <link rel="stylesheet" href="../_static/pygments.css">
      <link rel="stylesheet" href="../_static/theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

      
      <script src="../_static/theme-vendors.js"></script>
      <script src="../_static/theme.js" defer></script>
    
    <link rel="icon" href="../_static/favicon.ico" type="image/x-icon" />
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Recherche" href="../search.html" />
  <link rel="next" title="19 Portée et visibilité" href="scopes.html" />
  <link rel="prev" title="17 Algorithmes et conception" href="algorithms.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../index.html" class="home-link">
    
      <span class="site-name">Le C pour l&#39;ingénieur</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link  router-link-active">
         Table des matières
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Annexes
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Références
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link  router-link-active">
         Table des matières
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Annexes
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Références
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Recherche rapide</span>
    <div class="searchformwrapper">
      <form class="search" action="../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Recherche" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#le-c-pour-l-ingenieur">Table des matières</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="introduction.html" class="reference internal ">Introduction</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="programming.html" class="reference internal ">La programmation</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="foundations.html" class="reference internal ">Généralités du langage</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="numeration.html" class="reference internal ">Numération</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="operators.html" class="reference internal ">Opérateurs</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="datatype.html" class="reference internal ">Types de données</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="control-structures.html" class="reference internal ">Structures de contrôle</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="processus.html" class="reference internal ">Programmes et Processus</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="stdio.html" class="reference internal ">Entrées Sorties</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="functions.html" class="reference internal ">Fonctions</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="composite-datatypes.html" class="reference internal ">Types composites</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="files.html" class="reference internal ">Les  fichiers</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="memory-management.html" class="reference internal ">Gestion de la mémoire</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="pointers.html" class="reference internal ">Pointeurs</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="standard-library.html" class="reference internal ">Bibliothèques</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="preprocessor.html" class="reference internal ">Préprocesseur</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="algorithms.html" class="reference internal ">Algorithmes et conception</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">Compilation séparée</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#unite-de-traduction" class="reference internal">Unité de traduction</a></li>
                
                  <li class="toctree-l2"><a href="#diviser-pour-mieux-regner" class="reference internal">Diviser pour mieux régner</a></li>
                
                  <li class="toctree-l2"><a href="#module-logiciel" class="reference internal">Module logiciel</a></li>
                
                  <li class="toctree-l2"><a href="#compilation-avec-assemblage-differe" class="reference internal">Compilation avec assemblage différé</a></li>
                
                  <li class="toctree-l2"><a href="#fichiers-d-en-tete-header" class="reference internal">Fichiers d'en-tête (header)</a></li>
                
                  <li class="toctree-l2"><a href="#en-profondeur" class="reference internal">En profondeur</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 "><a href="scopes.html" class="reference internal ">Portée et visibilité</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="testing.html" class="reference internal ">Qualité et Testabilité</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="data-structures.html" class="reference internal ">Structures de données</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="advanced-topics.html" class="reference internal ">Avancé</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="traps.html" class="reference internal ">Pièges</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="philosophy.html" class="reference internal ">Philosophie</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#le-c-pour-l-ingenieur">Annexes</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../appendix/vscode.html" class="reference internal ">Visual Studio Code</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/grammar.html" class="reference internal ">Grammaire C</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/bash.html" class="reference internal ">Ligne de commande</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/development.html" class="reference internal ">Environnement de développement</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/unit.html" class="reference internal ">Fiches d'unités de cours</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/laboratories.html" class="reference internal ">Laboratoires</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#le-c-pour-l-ingenieur">Références</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../backmatter/exercises.html" class="reference internal ">Solution des exercices</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../backmatter/bibliography.html" class="reference internal ">Bibliographie</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../backmatter/glossary.html" class="reference internal ">Glossaire</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
    <li><span class="section-number">18  </span>Compilation séparée</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="algorithms.html"
       title="Chapitre précédent">← <span class="section-number">17  </span>Algorithmes et conception</a>
  </li>
  <li class="next">
    <a href="scopes.html"
       title="Chapitre suivant"><span class="section-number">19  </span>Portée et visibilité →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <div class="section" id="compilation-separee">
<span id="translationunits"></span><h1><span class="section-number">18  </span>Compilation séparée<a class="headerlink" href="#compilation-separee" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="unite-de-traduction">
<h2><span class="section-number">18.1  </span>Unité de traduction<a class="headerlink" href="#unite-de-traduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>En programmation, on appelle <em>translation unit</em> (unité de traduction), un code qui peut être <strong>compilé</strong> en un <strong>objet</strong> sans autre dépendance externe. Le plus souvent, une unité de traduction correspond à un fichier C.</p>
</div>
<div class="section" id="diviser-pour-mieux-regner">
<h2><span class="section-number">18.2  </span>Diviser pour mieux régner<a class="headerlink" href="#diviser-pour-mieux-regner" title="Lien permanent vers ce titre">¶</a></h2>
<p>De même qu'un magasine illustré est divisé en sections pour accroître la lisibilité (sport, news, annonces, météo) de même un code source est organisé en éléments fonctionnels le plus souvent séparés en plusieurs fichiers et ces derniers parfois maintenus par différents développeurs.</p>
<p>Rappelons-le (et c'est très important) :</p>
<ul class="simple">
<li><p>une fonction ne devrait pas dépasser un écran de haut (~50 lignes) ;</p></li>
<li><p>un fichier ne devrait pas dépasser 1000 lignes ;</p></li>
<li><p>une ligne ne devrait pas dépasser 80 caractères.</p></li>
</ul>
<p>Donc à un moment, il est essentiel de diviser son travail en créant plusieurs fichiers.</p>
<p>Ainsi, lorsque le programme commence à être volumineux, sa lecture, sa compréhension et sa mise au point deviennent délicates même pour le plus aguerri des développeurs. Il est alors essentiel de scinder le code source en plusieurs fichiers. Prenons l'exemple d'un programme qui effectue des calculs sur les nombres complexes. Notre projet est donc constitué de trois fichiers :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>tree
<span class="go">.</span>
<span class="go">├── complex.c</span>
<span class="go">├── complex.h</span>
<span class="go">└── main.c</span>
</pre></div>
</div>
<p>Le programme principal et la fonction <code class="docutils literal notranslate"><span class="pre">main</span></code> est contenu dans <code class="docutils literal notranslate"><span class="pre">main.c</span></code> quant au module <em>complex</em> il est composé de deux fichiers : <code class="docutils literal notranslate"><span class="pre">complex.h</span></code> l'en-tête et <code class="docutils literal notranslate"><span class="pre">complex.c</span></code>, l'implémentation du module.</p>
<p>Le fichier <code class="docutils literal notranslate"><span class="pre">main.c</span></code> devra inclure le fichier <code class="docutils literal notranslate"><span class="pre">complex.h</span></code> afin de
pourvoir utiliser correctement les fonctions du module de gestion des
nombres complexes. Exemple :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// fichier main.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;complex.h&quot;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Complex</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">imag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">complex_fprint</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// fichier complex.h</span>
<span class="cp">#ifndef COMPLEX_H</span>
<span class="cp">#define COMPLEX_H</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Complex</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">real</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">imag</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">Complex</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">pComplex</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">complex_fprint</span><span class="p">(</span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Complex</span><span class="w"> </span><span class="n">c</span><span class="p">);</span><span class="w"></span>

<span class="cp">#endif </span><span class="c1">// COMPLEX_H</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// fichier complex.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;complex.h&quot;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">complex_fprint</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Complex</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%+.3lf + %+.3lf</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">imag</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Un des avantages majeurs à la création de modules est qu'un module
logiciel peut être réutilisé pour d'autres applications. Plus besoin de
réinventer la roue à chaque application !</p>
<p>Cet exemple sera compilé dans un environnement POSIX de la façon suivante :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">gcc -c complex.c -o complex.o</span>
<span class="go">gcc -c main.c -o main.o</span>
<span class="go">gcc complex.o main.o -oprogram -lm</span>
</pre></div>
</div>
<p>Nous verrons plus bas les éléments théoriques vous permettant de mieux comprendre ces lignes.</p>
</div>
<div class="section" id="module-logiciel">
<h2><span class="section-number">18.3  </span>Module logiciel<a class="headerlink" href="#module-logiciel" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les applications modernes dépendent souvent de nombreux modules logiciels externes aussi utilisés dans d'autres projets. C'est avantageux à plus d'un titre :</p>
<ul class="simple">
<li><p>les modules externes sont sous la responsabilité d'autres développeurs et le programme a développer comporte moins de code ;</p></li>
<li><p>les modules externes sont souvent bien documentés et testés et il est facile de les utiliser ;</p></li>
<li><p>la lisibilité du programme est accrue, car il est bien découpé en des ensembles fonctionnels ;</p></li>
<li><p>les modules externes sont réutilisables et indépendants, ils peuvent donc être réutilisés sur plusieurs projets.</p></li>
</ul>
<p>Lorsque vous utilisez la fonction <code class="docutils literal notranslate"><span class="pre">printf</span></code>, vous dépendez d'un module externe nommé <code class="docutils literal notranslate"><span class="pre">stdio</span></code>. En réalité l'ensemble des modules <code class="docutils literal notranslate"><span class="pre">stdio</span></code>, <code class="docutils literal notranslate"><span class="pre">stdlib</span></code>, <code class="docutils literal notranslate"><span class="pre">stdint</span></code>, <code class="docutils literal notranslate"><span class="pre">ctype</span></code>... sont tous groupés dans une seule bibliothèque logicielle nommée <code class="docutils literal notranslate"><span class="pre">libc</span></code> disponible sur tous les systèmes compatibles POSIX. Sous Linux, le pendant libre <code class="docutils literal notranslate"><span class="pre">glibc</span></code> est utilisé. Il s'agit de la bibliothèque <a class="reference external" href="https://fr.wikipedia.org/wiki/GNU_C_Library">GNU C Library</a>.</p>
<p>Un module logiciel peut se composer de fichiers sources, c'est-à-dire un ensemble de fichiers <code class="docutils literal notranslate"><span class="pre">.c</span></code> et <code class="docutils literal notranslate"><span class="pre">.h</span></code> ainsi qu'une documentation et un script de compilation (<code class="docutils literal notranslate"><span class="pre">Makefile</span></code>). Alternativement, un module logiciel peut se composer de bibliothèques déjà compilées sous la forme de fichiers <code class="docutils literal notranslate"><span class="pre">.h</span></code>, <code class="docutils literal notranslate"><span class="pre">.a</span></code> et <code class="docutils literal notranslate"><span class="pre">.so</span></code>. Sous Windows on rencontre fréquemment l'extension <code class="docutils literal notranslate"><span class="pre">.dll</span></code>. Ces fichiers compilés ne donnent pas accès au code source, mais permettent d'utiliser les fonctionnalités quelles offrent dans des programmes C en mettant à disposition un ensemble de fonctions documentées.</p>
</div>
<div class="section" id="compilation-avec-assemblage-differe">
<h2><span class="section-number">18.4  </span>Compilation avec assemblage différé<a class="headerlink" href="#compilation-avec-assemblage-differe" title="Lien permanent vers ce titre">¶</a></h2>
<p>Lorsque nous avions compilé notre premier exemple <a class="reference external" href="hello">Hello World</a> nous avions simplement appelé <code class="docutils literal notranslate"><span class="pre">gcc</span></code> avec le fichier source <code class="docutils literal notranslate"><span class="pre">hello.c</span></code> qui nous avait créé un exécutable <code class="docutils literal notranslate"><span class="pre">a.out</span></code>. En réalité, GCC est passé par plusieurs sous-étapes de compilation :</p>
<ol class="arabic simple">
<li><p><strong>Préprocessing</strong> : les commentaires sont retirés, les directives préprocesseur sont remplacées par leur équivalent C.</p></li>
<li><p><strong>Compilation</strong> : le code C d'une seule <em>translation unit</em> est converti en langage machine en un fichier objet <code class="docutils literal notranslate"><span class="pre">.o</span></code>.</p></li>
<li><p><strong>Édition des liens</strong> : aussi nommés <em>link</em>, les différents fichiers objets sont réunis en un seul exécutable.</p></li>
</ol>
<p>Lorsqu'un seul fichier est fourni à GCC, les trois opérations sont effectuées en même temps, mais ce n'est plus possible aussitôt que le programme est composé de plusieurs unités de translation (plusieurs fichiers C). Il est alors nécessaire de compiler manuellement chaque fichier source et d'en créer.</p>
<p>La figure suivante résume les différentes étapes de GCC. Les pointillés indiquent à quel niveau les opérations peuvent s'arrêter. Il est dès lors possible de passer par des fichiers intermédiaires assembleur (<code class="docutils literal notranslate"><span class="pre">.s</span></code>) ou objets (<code class="docutils literal notranslate"><span class="pre">.o</span></code>) en utilisant la bonne commande.</p>
<div class="figure align-default" id="id1">
<img alt="../_images/gcc.svg" src="../_images/gcc.svg" /><p class="caption"><span class="caption-number">Fig. 18.1 </span><span class="caption-text">Étapes intermédiaires de compilation avec GCC</span><a class="headerlink" href="#id1" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Notons que ces étapes existent, quel que soit le compilateur ou le système d'exploitation. Nous retrouverons ces exactes mêmes étapes avec Microsoft Visual Studio, mais le nom des commandes et les extensions des fichiers peuvent varier s'ils ne respectent pas la norme POSIX (et GNU).</p>
<p>Notons que généralement, seul deux étapes de GCC sont utilisées :</p>
<ol class="arabic simple">
<li><p>Compilation avec <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">-c</span> <span class="pre">&lt;fichier.c&gt;</span></code>, ceci génère automatiquement un fichier <code class="docutils literal notranslate"><span class="pre">.o</span></code> du même nom que le fichier d'entrée.</p></li>
<li><p>Édition des liens avec <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">&lt;fichier1.o&gt;</span> <span class="pre">&lt;fichier2.o&gt;</span> <span class="pre">...</span></code>, ceci génère automatiquement un fichier exécutable <code class="docutils literal notranslate"><span class="pre">a.out</span></code>.</p></li>
</ol>
</div>
<div class="section" id="fichiers-d-en-tete-header">
<h2><span class="section-number">18.5  </span>Fichiers d'en-tête (<em>header</em>)<a class="headerlink" href="#fichiers-d-en-tete-header" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les fichiers d'en-tête (<code class="docutils literal notranslate"><span class="pre">.h</span></code>) sont des fichiers écrits en langage C, mais qui ne contiennent pas d'implémentation de fonctions. Un tel fichier ne contient donc pas de <code class="docutils literal notranslate"><span class="pre">while</span></code>, de <code class="docutils literal notranslate"><span class="pre">for</span></code> ou même de <code class="docutils literal notranslate"><span class="pre">if</span></code>. Par convention ces fichiers ne contiennent que :</p>
<ul class="simple">
<li><p>Des prototypes de fonctions (ou de variables).</p></li>
<li><p>Des déclarations de types (<code class="docutils literal notranslate"><span class="pre">typedef</span></code>, <code class="docutils literal notranslate"><span class="pre">struct</span></code>).</p></li>
<li><p>Des définitions préprocesseur (<code class="docutils literal notranslate"><span class="pre">#include</span></code>, <code class="docutils literal notranslate"><span class="pre">#define</span></code>).</p></li>
</ul>
<p>Nous l'avons vu dans le chapitre sur le préprocesseur, la directive <code class="docutils literal notranslate"><span class="pre">#include</span></code> ne fais qu'inclure le contenu du fichier cible à l'emplacement de la directive. Il est donc possible (mais fort déconseillé), d'avoir la situation suivante :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// main.c</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;foobar.def&quot;</span><span class="cp"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Et le fichier <code class="docutils literal notranslate"><span class="pre">foobar.def</span></code> pourrait contenir :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// foobar.def</span>
<span class="cp">#ifdef FOO</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello foo!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello bar!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Vous noterez que l'extension de <code class="docutils literal notranslate"><span class="pre">foobar</span></code> n'est pas <code class="docutils literal notranslate"><span class="pre">.h</span></code> puisque le contenu n'est pas un fichier d'en-tête. <code class="docutils literal notranslate"><span class="pre">.def</span></code> ou n'importe quelle autre extension pourrait donc faire l'affaire ici.</p>
<p>Dans cet exemple, le préprocesseur ne fait qu'inclure le contenu du fichier <code class="docutils literal notranslate"><span class="pre">foobar.def</span></code> à l'emplacement de la définition <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;foobar.def&quot;</span></code>. Voyons-le en détail :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat &lt;&lt; EOF &gt; main.c
<span class="go">int main() {</span>
<span class="gp">    #</span>include <span class="s2">&quot;foobar.def&quot;</span>
<span class="gp">    #</span>include <span class="s2">&quot;foobar.def&quot;</span>
<span class="go">}</span>
<span class="go">EOF</span>

<span class="gp">$ </span>cat &lt;&lt; EOF &gt; foobar.def
<span class="gp">#</span>ifdef FOO
<span class="go">printf(&quot;hello foo!\n&quot;);</span>
<span class="gp">#</span><span class="k">else</span>
<span class="go">printf(&quot;hello bar!\n&quot;);</span>
<span class="gp">#</span>endif
<span class="go">EOF</span>

<span class="gp">$ </span>gcc -E main.c <span class="p">|</span> sed <span class="s1">&#39;/^#/ d&#39;</span>
<span class="go">int main() {</span>
<span class="go">printf(&quot;hello bar\n&quot;);</span>
<span class="go">printf(&quot;hello bar\n&quot;);</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Lorsque l'on observe le résultat du préprocesseur, on s'aperçoit que toutes les directives préprocesseur ont disparues et que la directive <code class="docutils literal notranslate"><span class="pre">#include</span></code> a été remplacée par de contenu de <code class="docutils literal notranslate"><span class="pre">foobar.def</span></code>. Remarquons que le fichier est inclus deux fois, nous verrons plus loin comme éviter cela.</p>
<p>Nous avons vu au chapitre sur les <a class="reference external" href="function_prototype">prototypes de fonctions</a> qu'il est possible de ne déclarer que la première ligne d'une fonction. Ce prototype permet au compilateur de savoir combien d'arguments est composé une fonction sans nécessairement disposer de l'implémentation de cette fonction. Aussi on trouve dans tous les fichiers d'en-tête des déclaration en amont (<em>forward declaration</em>). Dans le fichier d'en-tête <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code> on trouvera la ligne : <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">printf(</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*restrict</span> <span class="pre">format,</span> <span class="pre">...</span> <span class="pre">);</span></code>.</p>
<p>Notons qu'ici le prototype est précédé par le mot clé <code class="docutils literal notranslate"><span class="pre">extern</span></code>. Il s'agit d'un mot clé <strong>optionnel</strong> permettant de renforcer l'intention du développeur que la fonction déclarée n'est pas inclue dans fichier courant, mais qu'elle est implémentée ailleurs, dans un autre fichier. Et c'est le cas, car <code class="docutils literal notranslate"><span class="pre">printf</span></code> est déjà compilée quelque part dans la bibliothèque <code class="docutils literal notranslate"><span class="pre">libc</span></code> inclue par défaut lorsqu'un programme C est compilé dans un environnement POSIX.</p>
<p>Un fichier d'en-tête contiendra donc tout le nécessaire utile à pouvoir utiliser une bibliothèque externe.</p>
<div class="section" id="protection-de-reentrance">
<h3><span class="section-number">18.5.1  </span>Protection de réentrance<a class="headerlink" href="#protection-de-reentrance" title="Lien permanent vers ce titre">¶</a></h3>
<p>La protection de réentrence aussi nommée <em>header guards</em> est une solution au problème d'inclusion multiple. Si par exemple on définit dans un fichier d'en-tête un nouveau type et que l'on inclus ce fichier, mais que ce dernier est déjà inclus par une autre bibliothèque une erreur de compilation apparaîtra :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat &lt;&lt; EOF &gt; main.c
<span class="go">→ #include &quot;foo.h&quot;</span>
<span class="go">→ #include &quot;bar.h&quot;</span>
<span class="go">→ int main() {</span>
<span class="go">→    Bar bar = {0};</span>
<span class="go">→    foo(bar);</span>
<span class="go">→ }</span>
<span class="go">→ EOF</span>

<span class="gp">$ </span>cat &lt;&lt; EOF &gt; foo.h
<span class="go">→ #include &quot;bar.h&quot;</span>
<span class="go">→</span>
<span class="go">→ extern void foo(Bar);</span>
<span class="go">→ EOF</span>

<span class="gp">$ </span>cat &lt;&lt; EOF &gt; bar.h
<span class="go">→ typedef struct Bar {</span>
<span class="go">→    int b, a, r;</span>
<span class="go">→ } Bar;</span>
<span class="go">→ EOF</span>

<span class="gp">$ </span>gcc main.c
<span class="go">In file included from main.c:2:0 :</span>
<span class="go">bar.h:1:16: error: redefinition of ‘struct Bar’</span>
<span class="go">typedef struct Bar {</span>
<span class="go">                ^~~</span>
<span class="go">In file included from foo.h:1:0,</span>
<span class="go">                from main.c:1 :</span>
<span class="go">bar.h:1:16: note: originally defined here</span>
<span class="go">typedef struct Bar {</span>
<span class="go">                ^~~</span>
<span class="go">In file included from main.c:2:0 :</span>
<span class="go">bar.h:3:3: error: conflicting types for ‘Bar’</span>
<span class="go">} Bar;</span>
<span class="go">^~~</span>
<span class="go">...</span>
</pre></div>
</div>
<p>Dans cet exemple l'utilisateur ne sait pas forcément que <code class="docutils literal notranslate"><span class="pre">bar.h</span></code> est déjà inclus avec <code class="docutils literal notranslate"><span class="pre">foo.h</span></code> et le résultat après pré-processing est le suivant :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>gcc -E main.c <span class="p">|</span> sed <span class="s1">&#39;/^#/ d&#39;</span>
<span class="go">typedef struct Bar {</span>
<span class="go">int b, a, r;</span>
<span class="go">} Bar;</span>

<span class="go">extern void foo(Bar);</span>
<span class="go">typedef struct Bar {</span>
<span class="go">int b, a, r;</span>
<span class="go">} Bar;</span>
<span class="go">int main() {</span>
<span class="go">Bar bar = {0};</span>
<span class="go">foo(bar);</span>
<span class="go">}</span>
</pre></div>
</div>
<p>On y retrouve la définition de <code class="docutils literal notranslate"><span class="pre">Bar</span></code> deux fois et donc, le compilateur génère une erreur.</p>
<p>Une solution à ce problème est d'ajouter des gardes d'inclusion multiple par exemple avec ceci:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef BAR_H</span>
<span class="cp">#define BAR_H</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">Bar</span><span class="p">;</span><span class="w"></span>

<span class="cp">#endif </span><span class="c1">// BAR_H</span>
</pre></div>
</div>
<p>Si aucune définition du type <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">BAR_H</span></code> n'existe, alors le fichier <code class="docutils literal notranslate"><span class="pre">bar.h</span></code> n'a jamais été inclus auparavant et le contenu de la directive <code class="docutils literal notranslate"><span class="pre">#ifndef</span> <span class="pre">BAR_H</span></code> dans lequel on commence par définir <code class="docutils literal notranslate"><span class="pre">BAR_H</span></code> est exécuté. Lors d'une future inclusion de <code class="docutils literal notranslate"><span class="pre">bar.h</span></code>, la valeur de <code class="docutils literal notranslate"><span class="pre">BAR_H</span></code> aura déjà été définie et le contenu de la directive <code class="docutils literal notranslate"><span class="pre">#ifndef</span> <span class="pre">BAR_H</span></code> ne sera jamais exécuté.</p>
<p>Alternativement, il existe une solution <strong>non standard</strong>, mais supportée par la plupart des compilateurs. Elle fait intervenir un pragma :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">Bar</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Cette solution est équivalente à la méthode traditionnelle et présente plusieurs avantages. C'est tout d'abord une solution atomique qui ne nécessite pas un <code class="docutils literal notranslate"><span class="pre">#endif</span></code> à la fin du fichier. Il n'y a ensuite pas de conflit avec la règle SSOT, car le nom du fichier <code class="docutils literal notranslate"><span class="pre">bar.h</span></code> n'apparaît pas dans le fichier <code class="docutils literal notranslate"><span class="pre">BAR_H</span></code>.</p>
</div>
</div>
<div class="section" id="en-profondeur">
<h2><span class="section-number">18.6  </span>En profondeur<a class="headerlink" href="#en-profondeur" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour mieux comprendre la compilation séparée, tentons d'observer le code assembleur généré. Considérons le fichier <code class="docutils literal notranslate"><span class="pre">foo.c</span></code> :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Puisqu'il ne contient pas de fonction main, il n'est pas possible de compiler ce fichier en un exécutable car il manque un point d'entrée :</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>gcc foo.c
/usr/bin/ld: /usr/lib/x86_64-linux-gnu/Scrt1.o: <span class="k">in</span> <span class="k">function</span> <span class="s1">&#39;_start&#39;</span>:
<span class="o">(</span>.text+0x24<span class="o">)</span>: undefined reference to <span class="s1">&#39;main&#39;</span>
collect2: error: ld returned <span class="m">1</span> <span class="nb">exit</span> status
</pre></div>
</div>
<p>Le <em>linker</em> se termine avec une erreur : <em>référence à 'main' inexistante</em>.</p>
<p>En revanche, il est possible de compiler un objet, c'est à dire générer les instructions assembleur. La fonction <code class="docutils literal notranslate"><span class="pre">bar</span></code> étant manquante, le compilateur suppose qu'elle existe quelque part en mémoire et se contentera de dire <em>moi j'appelle cette fonction ou qu'elle se trouve</em>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">$objdump</span> -d foo.o

foo.o:     file format elf64-x86-64

Disassembly of section .text:

<span class="m">0000000000000000</span> &lt;foo&gt;:
 <span class="m">0</span>:   f3 0f 1e fa       endbr64
 <span class="m">4</span>:   <span class="m">55</span>                push   %rbp
 <span class="m">5</span>:   <span class="m">48</span> <span class="m">89</span> e5          mov    %rsp,%rbp
 <span class="m">8</span>:   <span class="m">48</span> <span class="m">83</span> ec <span class="m">10</span>       sub    <span class="nv">$0</span>x10,%rsp
 c:   <span class="m">89</span> 7d <span class="nb">fc</span>          mov    %edi,-0x4<span class="o">(</span>%rbp<span class="o">)</span>
 f:   8b <span class="m">45</span> <span class="nb">fc</span>          mov    -0x4<span class="o">(</span>%rbp<span class="o">)</span>,%eax
<span class="m">12</span>:   <span class="m">89</span> c7             mov    %eax,%edi
<span class="m">14</span>:   e8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>    callq  <span class="m">19</span> &lt;foo+0x19&gt;
<span class="m">19</span>:   <span class="m">83</span> c0 2a          add    <span class="nv">$0</span>x2a,%eax
1c:   c9                leaveq
1d:   c3                retq
</pre></div>
</div>
<p>On constate à la ligne <code class="docutils literal notranslate"><span class="pre">19</span></code> que l'addition à bien lieu <code class="docutils literal notranslate"><span class="pre">eax</span> <span class="pre">+</span> <span class="pre">42</span></code>, et que l'appel de la fonction <cite>bar</cite> se produit à la ligne <code class="docutils literal notranslate"><span class="pre">14</span></code>.</p>
<p>Maintenant considérons le programme principal :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>En générant l'objet <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">-c</span> <span class="pre">main.c</span></code>, on peut également afficher l'assembleur généré avec <code class="docutils literal notranslate"><span class="pre">objdump</span></code> :</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">$objdump</span> -d main.o

main.o:     file format elf64-x86-64

Disassembly of section .text:

<span class="m">0000000000000000</span> &lt;bar&gt;:
 <span class="m">0</span>:   f3 0f 1e fa             endbr64
 <span class="m">4</span>:   <span class="m">55</span>                      push   %rbp
 <span class="m">5</span>:   <span class="m">48</span> <span class="m">89</span> e5                mov    %rsp,%rbp
 <span class="m">8</span>:   <span class="m">89</span> 7d <span class="nb">fc</span>                mov    %edi,-0x4<span class="o">(</span>%rbp<span class="o">)</span>
 b:   8b <span class="m">45</span> <span class="nb">fc</span>                mov    -0x4<span class="o">(</span>%rbp<span class="o">)</span>,%eax
 e:   <span class="m">01</span> c0                   add    %eax,%eax
<span class="m">10</span>:   5d                      pop    %rbp
<span class="m">11</span>:   c3                      retq

<span class="m">0000000000000012</span> &lt;main&gt;:
<span class="m">12</span>:   f3 0f 1e fa             endbr64
<span class="m">16</span>:   <span class="m">55</span>                      push   %rbp
<span class="m">17</span>:   <span class="m">48</span> <span class="m">89</span> e5                mov    %rsp,%rbp
1a:   bf 2a <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          mov    <span class="nv">$0</span>x2a,%edi
1f:   e8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          callq  <span class="m">24</span> &lt;main+0x12&gt;
<span class="m">24</span>:   <span class="m">89</span> c6                   mov    %eax,%esi
<span class="m">26</span>:   <span class="m">48</span> 8d 3d <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>    lea    0x0<span class="o">(</span>%rip<span class="o">)</span>,%rdi
2d:   b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          mov    <span class="nv">$0</span>x0,%eax
<span class="m">32</span>:   e8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          callq  <span class="m">37</span> &lt;main+0x25&gt;
<span class="m">37</span>:   b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          mov    <span class="nv">$0</span>x0,%eax
3c:   5d                      pop    %rbp
3d:   c3                      retq
</pre></div>
</div>
<p>On observe l'appel de la fonction <code class="docutils literal notranslate"><span class="pre">foo</span></code> à la ligne <code class="docutils literal notranslate"><span class="pre">1f</span></code> et l'appel de <code class="docutils literal notranslate"><span class="pre">printf</span></code> à la ligne <code class="docutils literal notranslate"><span class="pre">32</span></code>.</p>
<p>L'assemblage de ces deux fichiers en un exécutable résoud les liens en modifiant les adresses d'appel des fonctions puisqu'elles sont maintenant connues (notons que certaines lignes ont été retirées pour plus de lisibilité) :</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ gcc foo.o main.o
$ objdump -d a.out

a.out:     file format elf64-x86-64

Disassembly of section .text:

<span class="m">0000000000001149</span> &lt;foo&gt;:
    <span class="m">1149</span>:       f3 0f 1e fa             endbr64
    114d:       <span class="m">55</span>                      push   %rbp
    114e:       <span class="m">48</span> <span class="m">89</span> e5                mov    %rsp,%rbp
    <span class="m">1151</span>:       <span class="m">48</span> <span class="m">83</span> ec <span class="m">10</span>             sub    <span class="nv">$0</span>x10,%rsp
    <span class="m">1155</span>:       <span class="m">89</span> 7d <span class="nb">fc</span>                mov    %edi,-0x4<span class="o">(</span>%rbp<span class="o">)</span>
    <span class="m">1158</span>:       8b <span class="m">45</span> <span class="nb">fc</span>                mov    -0x4<span class="o">(</span>%rbp<span class="o">)</span>,%eax
    115b:       <span class="m">89</span> c7                   mov    %eax,%edi
    115d:       e8 <span class="m">05</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          callq  <span class="m">1167</span> &lt;bar&gt;
    <span class="m">1162</span>:       <span class="m">83</span> c0 2a                add    <span class="nv">$0</span>x2a,%eax
    <span class="m">1165</span>:       c9                      leaveq
    <span class="m">1166</span>:       c3                      retq

<span class="m">0000000000001167</span> &lt;bar&gt;:
    <span class="m">1167</span>:       f3 0f 1e fa             endbr64
    116b:       <span class="m">55</span>                      push   %rbp
    116c:       <span class="m">48</span> <span class="m">89</span> e5                mov    %rsp,%rbp
    116f:       <span class="m">89</span> 7d <span class="nb">fc</span>                mov    %edi,-0x4<span class="o">(</span>%rbp<span class="o">)</span>
    <span class="m">1172</span>:       8b <span class="m">45</span> <span class="nb">fc</span>                mov    -0x4<span class="o">(</span>%rbp<span class="o">)</span>,%eax
    <span class="m">1175</span>:       <span class="m">01</span> c0                   add    %eax,%eax
    <span class="m">1177</span>:       5d                      pop    %rbp
    <span class="m">1178</span>:       c3                      retq

<span class="m">0000000000001179</span> &lt;main&gt;:
    <span class="m">1179</span>:       f3 0f 1e fa             endbr64
    117d:       <span class="m">55</span>                      push   %rbp
    117e:       <span class="m">48</span> <span class="m">89</span> e5                mov    %rsp,%rbp
    <span class="m">1181</span>:       bf 2a <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          mov    <span class="nv">$0</span>x2a,%edi
    <span class="m">1186</span>:       e8 be ff ff ff          callq  <span class="m">1149</span> &lt;foo&gt;
    118b:       <span class="m">89</span> c6                   mov    %eax,%esi
    118d:       <span class="m">48</span> 8d 3d <span class="m">70</span> 0e <span class="m">00</span> <span class="m">00</span>    lea    0xe70<span class="o">(</span>%rip<span class="o">)</span>,%rdi
    <span class="m">1194</span>:       b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          mov    <span class="nv">$0</span>x0,%eax
    <span class="m">1199</span>:       e8 b2 fe ff ff          callq  <span class="m">1050</span> &lt;printf@plt&gt;
    119e:       b8 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>          mov    <span class="nv">$0</span>x0,%eax
    11a3:       5d                      pop    %rbp
    11a4:       c3                      retq
    11a5:       <span class="m">66</span> 2e 0f 1f <span class="m">84</span> <span class="m">00</span> <span class="m">00</span>    nopw   %cs:0x0<span class="o">(</span>%rax,%rax,1<span class="o">)</span>
    11ac:       <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>
    11af:       <span class="m">90</span>                      nop
</pre></div>
</div>
<p>On constate que les appels de fonctions ont été bien remplacés par les bon noms :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">115d</span></code> Appel de <code class="docutils literal notranslate"><span class="pre">bar</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1186</span></code> Appel de <code class="docutils literal notranslate"><span class="pre">foo</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1199</span></code> Appel de <code class="docutils literal notranslate"><span class="pre">printf</span></code></p></li>
</ul>
</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="algorithms.html"
       title="Chapitre précédent">← <span class="section-number">17  </span>Algorithmes et conception</a>
  </li>
  <li class="next">
    <a href="scopes.html"
       title="Chapitre suivant"><span class="section-number">19  </span>Portée et visibilité →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright HEIG-VD(c) 2022.
    Mis à jour le 18 févr. 2022 (version v0.3.0-30-g2b759bb).
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1 with <a href="https://github.com/heig-vd-tin/sphinx_heigvd_theme">HEIG-VD Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>