<!DOCTYPE html>
<html  lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-145664552-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-145664552-1');
    </script>
    
      <title>14Pointeurs</title>
    
      <link rel="stylesheet" href="../_static/pygments.css">
      <link rel="stylesheet" href="../_static/theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

      
      <script src="../_static/theme-vendors.js"></script>
      <script src="../_static/theme.js" defer></script>
    
    <link rel="icon" href="../_static/favicon.ico" type="image/x-icon" />
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Recherche" href="../search.html" />
  <link rel="next" title="15Biblioth√®ques" href="standard-library.html" />
  <link rel="prev" title="13Gestion de la m√©moire" href="memory-management.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../index.html" class="home-link">
    
      <span class="site-name">Le C pour l&#39;ingenieur</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link  router-link-active">
         Table des mati√®res
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Annexes
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link  router-link-active">
         Table des mati√®res
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Annexes
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Recherche rapide</span>
    <div class="searchformwrapper">
      <form class="search" action="../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Recherche" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#le-c-pour-l-ingenieur">Table des mati√®res</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="introduction.html" class="reference internal ">Introduction</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="programming.html" class="reference internal ">La programmation</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="foundations.html" class="reference internal ">G√©n√©ralit√©s du langage</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="numeration.html" class="reference internal ">Num√©ration</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="operators.html" class="reference internal ">Op√©rateurs</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="datatype.html" class="reference internal ">Types de donn√©es</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="control-structures.html" class="reference internal ">Structures de contr√¥le</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="processus.html" class="reference internal ">Programmes et Processus</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="stdio.html" class="reference internal ">Entr√©es Sorties</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="functions.html" class="reference internal ">Fonctions</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="composite-datatypes.html" class="reference internal ">Types composites</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="files.html" class="reference internal ">Les  fichiers</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="memory-management.html" class="reference internal ">Gestion de la m√©moire</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">Pointeurs</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#pointeur-simple" class="reference internal">Pointeur simple</a></li>
                
                  <li class="toctree-l2"><a href="#arithmetique-de-pointeurs" class="reference internal">Arithm√©tique de pointeurs</a></li>
                
                  <li class="toctree-l2"><a href="#pointeur-et-chaines-de-caracteres" class="reference internal">Pointeur et cha√Ænes de caract√®res</a></li>
                
                  <li class="toctree-l2"><a href="#structures-et-pointeurs" class="reference internal">Structures et pointeurs</a></li>
                
                  <li class="toctree-l2"><a href="#transtypage-de-pointeurs-cast" class="reference internal">Transtypage de pointeurs (cast)</a></li>
                
                  <li class="toctree-l2"><a href="#pointeurs-de-fonctions" class="reference internal">Pointeurs de fonctions</a></li>
                
                  <li class="toctree-l2"><a href="#la-regle-gauche-droite" class="reference internal">La r√®gle gauche-droite</a></li>
                
                  <li class="toctree-l2"><a href="#initialisation-par-transtypage" class="reference internal">Initialisation par transtypage</a></li>
                
                  <li class="toctree-l2"><a href="#enchevetrement-ou-aliasing" class="reference internal">Enchev√™trement ou Aliasing</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 "><a href="standard-library.html" class="reference internal ">Biblioth√®ques</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="preprocessor.html" class="reference internal ">Pr√©processeur</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="algorithms.html" class="reference internal ">Algorithmes et conception</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="translation-units.html" class="reference internal ">Compilation s√©par√©e</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="scopes.html" class="reference internal ">Port√©e et visibilit√©</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="testing.html" class="reference internal ">Qualit√© et Testabilit√©</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="data-structures.html" class="reference internal ">Structures de donn√©es</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="advanced-topics.html" class="reference internal ">Avanc√©</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="traps.html" class="reference internal ">Pi√®ges</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="philosophy.html" class="reference internal ">Philosophie</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#le-c-pour-l-ingenieur">Annexes</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../appendix/vscode.html" class="reference internal ">Visual Studio Code</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/grammar.html" class="reference internal ">Grammaire C</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/bash.html" class="reference internal ">Ligne de commande</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/development.html" class="reference internal ">Environnement de d√©veloppement</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/unit.html" class="reference internal ">Fiches d'unit√©s</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/laboratories.html" class="reference internal ">Laboratoires</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
    <li><span class="section-number">14</span>Pointeurs</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="memory-management.html"
       title="Chapitre pr√©c√©dent">‚Üê <span class="section-number">13</span>Gestion de la m√©moire</a>
  </li>
  <li class="next">
    <a href="standard-library.html"
       title="Chapitre suivant"><span class="section-number">15</span>Biblioth√®ques ‚Üí</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <div class="section" id="pointeurs">
<span id="pointers"></span><h1><span class="section-number">14</span>Pointeurs<a class="headerlink" href="#pointeurs" title="Lien permanent vers ce titre">¬∂</a></h1>
<p><a class="reference external" href="https://fr.wikiquote.org/wiki/Le_Jour_de_gloire">Attention les v√©los</a>, on s'attaque √† un sujet d√©licat, difficile, scabreux, mais n√©cessaire. Un sujet essentiel, indispensable et fantastique: les <a class="reference external" href="https://fr.wikipedia.org/wiki/Pointeur_(programmation)">pointeurs</a>.</p>
<p>Les pointeurs sont des <strong>variables</strong> qui, au lieu de stocker une valeur, stockent une <strong>adresse m√©moire</strong>. Dans quel but me direz-vous ? Pour cr√©er des indirections, simplifier l'ex√©cution du code.</p>
<p>Prenons un exemple concret. Le <a class="reference external" href="https://fr.wikipedia.org/wiki/Vicomte_de_Valmont">Vicomte de Valmont</a> d√©cide d'√©crire √† la marquise de Merteuil et il r√©dige une lettre. Il cachette sa lettre et la d√©pose dans sa bo√Æte aux lettres pour enl√®vement par le facteur moyennant quelques sous. En des termes programmatiques, on a :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">lettre</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Ch√®re Maquise, ...&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Cette variable <code class="docutils literal notranslate"><span class="pre">lettre</span></code> est d√®s lors enregistr√©e en m√©moire √† l'adresse <code class="docutils literal notranslate"><span class="pre">0x12345abc</span></code> qui pourrait correspondre √† l'emplacement de la bo√Æte aux lettres du Vicomte.</p>
<p>Le facteur qui ne craint pas la besogne prend connaissance du courrier √† livrer, mais constate avec effroi que le cachet de cire √† fondu sous l'effet du r√©chauffement climatique. La lettre est coll√©e au fond de la bo√Æte et il ne parvient pas √† la d√©tacher. Pire encore, et ajoutant √† la situation d√©j√† cocasse un dramatisme sans √©quivoque, √† forcer de ses maigres doigts le papier de l'enveloppe se d√©chire et le contenu de lettre ind√©collable lui est r√©v√©l√©e.</p>
<p>Je l'admets volontiers, il me faut bien faire quelques pirouettes pour justifier qu'une valeur en m√©moire ne peut √™tre transport√©e d'un lieu √† un autre √† simple dos de facteur. Aussi, notre facteur qui est si bon, mais qui n'a plus la m√©moire de sa jeunesse, ni papier d'ailleurs, d√©cide de m√©moriser la lettre et de la retranscrire chez madame la Marquise qu'il conna√Æt bien. Or comme il est atteint de la maladie de <em>64-bits</em> il n'arrive √† m√©moriser que 8 caract√®res <code class="docutils literal notranslate"><span class="pre">Ch√®re</span> <span class="pre">Ma</span></code>. Sur son bolide, il arrive √† destination et retranscrit dans le fond de la bo√Æte de madame de Merteuil les huit caract√®res fid√®lement retranscrits. Comme il est bonnet, mais assidu, il consacre le restant de sa journ√©e en des allers-retours usant la gomme de son <a class="reference external" href="https://www.paroles.net/georges-brassens/paroles-pour-me-rendre-a-mon-bureau">tout nickel√©</a> jusqu'√† ce que toute la lettre ait √©t√© retranscrite.</p>
<p>On se retrouve avec une <strong>copie</strong> de la lettre chez madame de Merteil :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">valmont_mailbox</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Ch√®re Maquise, ...&quot;</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">merteil_mailbox</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Ch√®re Maquise, ...&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>La canicule n'√©tant pas finie, et cette physique discutable ne pouvant √™tre d√©jou√©e, la marquise d√©cide de r√©soudre le probl√®me et se rends √† <a class="reference external" href="https://fr.wikipedia.org/wiki/Pierre_Choderlos_de_Laclos">Tarente</a> (un tr√®s mauvais choix par jour de canicule) et formule sa r√©ponse sur le mur sud du Castello Aragonese ayant pr√©alablement pris soin de noter la position GPS du mur avec exactitude (<code class="docutils literal notranslate"><span class="pre">0x30313233</span></code>):</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">castello_wall</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Cher Vicomte, ...&quot;</span><span class="p">;</span>
<span class="kt">char</span> <span class="p">(</span><span class="o">*</span><span class="n">gps_position</span><span class="p">)[]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">castello_wall</span><span class="p">;</span>
</pre></div>
</div>
<p>De retour chez elle, elle prie le facteur de transmettre au vicomte de Valmont ce simple mot: <code class="docutils literal notranslate"><span class="pre">0x30313233</span></code>. Le facteur parvient sans mal √† m√©moriser les 4 octets du message.</p>
<p>La variable <code class="docutils literal notranslate"><span class="pre">gps_position</span></code> ne contient donc pas le message, mais seulement l'adresse m√©moire de ce message. Il s'agit ici d'un <strong>pointeur sur un tableau de caract√®res</strong>.</p>
<p>Entre temps, le vicomte qui est paresseux s'est √©quip√© d'un t√©l√©scripteur capable d'ex√©cuter du code C et il parvient √† lire le message de sa complice la marquise.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gps_position</span><span class="p">);</span>
</pre></div>
</div>
<p>S'il avait oubli√© l'ast√©risque (<code class="docutils literal notranslate"><span class="pre">*</span></code>, <a class="reference external" href="https://unicode-table.com/en/002A/">U+002A</a>) dans cette derni√®re ligne il n'aurait pas vu le message esp√©r√©, mais simplement <code class="docutils literal notranslate"><span class="pre">0123</span></code> qui correspond au contenu √† l'adresse m√©moire ou se trouve l'adresse du message (et non le message).</p>
<p>L'ast√©risque agit donc comme un <strong>d√©r√©f√©rencement</strong>, autrement dit, la demande expresse faite au d√©vou√© facteur d'aller √† l'adresse donn√©e r√©cup√©rer le contenu du message.</p>
<p>Oui, mais, on utilise un ast√©risque pour d√©r√©f√©rencer, mais dans l'exemple pr√©c√©dant on a utilis√© l'esperluette (<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <a class="reference external" href="https://unicode-table.com/en/0026/">U+0026</a>): <code class="docutils literal notranslate"><span class="pre">&amp;castello_wall</span></code>, pourquoi ? L'esperluette quant elle pr√©fixe une variable peut √™tre traduite par <strong>l'adresse de</strong>. Cela revient √† l'√©tape pendant laquelle la marquise a mesur√© la position GPS du mur sur √† Tarente.</p>
<p>Il manque encore une chose, il y a aussi une ast√©risque sur <code class="docutils literal notranslate"><span class="pre">(*gps_position)[]</span></code>. Cela vaudrait-il dire qu‚Äôon d√©r√©f√©rence la position gps pour affecter l'adresse du mur ? Non, pas du tout... Et c'est d'ailleurs √† cette √©tape que les novices perdent le fil. O√π en √©tais-je ?</p>
<p>Notons qu'il y a plusieurs interpr√©tations de l'ast√©risque en C :</p>
<ul class="simple">
<li><p>Op√©rateur de multiplication: <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">*</span> <span class="pre">b</span></code></p></li>
<li><p>D√©r√©f√©rencement d'un pointeur: <code class="docutils literal notranslate"><span class="pre">*ptr</span></code></p></li>
<li><p>D√©claration d'un pointeur: <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*</span> <span class="pre">ptr</span></code></p></li>
</ul>
<p>Donc ici, on d√©clare un pointeur. En appliquant la r√®gle gauche-droite que l'on verra plus bas :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="p">(</span><span class="o">*</span><span class="n">gps_position</span><span class="p">)[]</span>
       <span class="o">^^^^^^^^^^^^</span>        <span class="mf">1.</span> <span class="n">gps_position</span> <span class="n">est</span>
                   <span class="o">^</span>       <span class="mf">2.</span> <span class="p">...</span>
      <span class="o">^</span>                    <span class="mf">3.</span> <span class="n">un</span> <span class="n">pointeur</span> <span class="n">sur</span>
                    <span class="o">^^</span>     <span class="mf">4.</span> <span class="n">un</span> <span class="n">tableau</span> <span class="n">de</span>
<span class="o">^^^^</span>                       <span class="mf">5.</span> <span class="n">caract√®res</span>
                           <span class="mf">6.</span> <span class="n">PROFIT</span><span class="p">...</span>
</pre></div>
</div>
<p>R√©sumons :</p>
<ul class="simple">
<li><p>Un pointeur est une <strong>variable</strong></p></li>
<li><p>Il contient une <strong>adresse m√©moire</strong></p></li>
<li><p>Il peut √™tre <strong>d√©r√©f√©renc√©</strong> pour en obtenir la valeur de l'√©l√©ment qu'il pointe</p></li>
<li><p><strong>L'adresse d'une variable</strong> peut √™tre obtenue avec une esperluette</p></li>
</ul>
<div class="section" id="pointeur-simple">
<h2><span class="section-number">14.1</span>Pointeur simple<a class="headerlink" href="#pointeur-simple" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>Le format le plus simple d'un pointeur sur un entier s'√©crit avec l'asterix <code class="docutils literal notranslate"><span class="pre">*</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</pre></div>
</div>
<p>La valeur <code class="docutils literal notranslate"><span class="pre">NULL</span></code> corresponds √† l'adresse nulle <code class="docutils literal notranslate"><span class="pre">0x00000000</span></code>. On utilise cette convention pour bien indiquer qu'il s'agit d'une adresse et non d'une valeur scalaire.</p>
<p>√Ä tout moment la valeur du pointeur peut √™tre assign√©e √† l'adresse d'un entier puisque nous avons d√©clar√© un pointeur sur un entier :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">boiling</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">freezing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">char</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">?</span> <span class="o">&amp;</span><span class="nl">boiling</span> <span class="p">:</span> <span class="o">&amp;</span><span class="n">freezing</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Lorsque nous avions vu les tableaux, nous √©crivions :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">array</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">};</span>
</pre></div>
</div>
<p>Vous ne le saviez pas, mais ùÑΩ <em>plot twist</em> ùÑΩ la variable <code class="docutils literal notranslate"><span class="pre">array</span></code> est un pointeur, et la preuve est que <code class="docutils literal notranslate"><span class="pre">array</span></code> peut √™tre d√©r√©f√©renc√©:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">array</span><span class="p">);</span>
</pre></div>
</div>
<p>La diff√©rence entre un <strong>tableau</strong> et un <strong>pointeur</strong> est la suivante :</p>
<ul class="simple">
<li><p>Il n'est pas possible d'assigner une adresse √† un tableau</p></li>
<li><p>Il n'est pas possible d'assigner des valeurs √† un pointeur</p></li>
</ul>
<p>D'ailleurs, l'op√©rateur crochet <code class="docutils literal notranslate"><span class="pre">[]</span></code> n'est rien d'autre qu'un sucre syntaxique :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">==</span> <span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="arithmetique-de-pointeurs">
<h2><span class="section-number">14.2</span>Arithm√©tique de pointeurs<a class="headerlink" href="#arithmetique-de-pointeurs" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>Fondamentalement un pointeur est une variable qui contient un <a class="reference external" href="https://fr.wikipedia.org/wiki/Nombre_ordinal">ordinal</a>, c'est-√†-dire qu'il peut √™tre imagin√© l'ajout √† un pointeur une grandeur finie :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">str</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Le vif z√©phyr jubile sur les kumquats du clown gracieux&quot;</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span> <span class="n">ptr</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">putchar</span><span class="p">(</span><span class="o">*</span><span class="n">ptr</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Imaginons que l'on souhaite repr√©senter le carr√© magique suivant :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>‚îå‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4 ‚îÇ 9 ‚îÇ 2 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 3 ‚îÇ 5 ‚îÇ 7 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 8 ‚îÇ 1 ‚îÇ 6 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îò
</pre></div>
</div>
<p>On peut le repr√©senter en m√©moire lin√©airement et utiliser de l'arithm√©tique de pointeur pour le dessiner :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">magic</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;492&quot;</span> <span class="s">&quot;357&quot;</span> <span class="s">&quot;816&quot;</span><span class="p">;</span>

<span class="kt">char</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="n">magic</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">row</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">col</span><span class="o">++</span><span class="p">)</span>
        <span class="n">putchar</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">col</span><span class="p">));</span>
    <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Mais ? N'est-ce pas l√† ce que fait le compilateur lorsque l'adresse les √©l√©ments d'un tableau multi dimensionnel ?</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">magic</span><span class="p">[][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;792&quot;</span><span class="p">,</span> <span class="s">&quot;357&quot;</span><span class="p">,</span> <span class="s">&quot;816&quot;</span><span class="p">};</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">row</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">col</span><span class="o">++</span><span class="p">)</span>
        <span class="n">putchar</span><span class="p">(</span><span class="n">magic</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]);</span>
    <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Oui tr√®s exactement, les deux codes sont similaires, mais l'un est plus √©l√©gant que l'autre, lequel d'apr√®s vous ?</p>
<p>L'arithm√©tique de pointeur est donc chose courante avec les tableaux. √Ä vrai dire, les deux concepts sont interchangeables :</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-number">Tableau 14.1 </span><span class="caption-text">Arithm√©tique sur tableau unidimensionnel</span><a class="headerlink" href="#id1" title="Lien permanent vers ce tableau">¬∂</a></caption>
<colgroup>
<col style="width: 23%" />
<col style="width: 13%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>√âlement</p></th>
<th class="head"><p>Premier</p></th>
<th class="head"><p>Deuxi√®me</p></th>
<th class="head"><p>Troisi√®me</p></th>
<th class="head"><p>n i√®me</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Acc√®s tableau</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[0]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[1]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[2]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[n</span> <span class="pre">-</span> <span class="pre">1]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Acc√®s pointeur</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*a</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*(a</span> <span class="pre">+</span> <span class="pre">1)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*(a</span> <span class="pre">+</span> <span class="pre">2)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*(a</span> <span class="pre">+</span> <span class="pre">n</span> <span class="pre">-</span> <span class="pre">1)</span></code></p></td>
</tr>
</tbody>
</table>
<p>De m√™me, l'exercice peut √™tre r√©p√©t√© avec des tableaux √† deux dimensions :</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-number">Tableau 14.2 </span><span class="caption-text">Arithm√©tique sur tableau bidimensionnel</span><a class="headerlink" href="#id2" title="Lien permanent vers ce tableau">¬∂</a></caption>
<colgroup>
<col style="width: 22%" />
<col style="width: 24%" />
<col style="width: 24%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>√âlement</p></th>
<th class="head"><p>Premier</p></th>
<th class="head"><p>Deuxi√®me</p></th>
<th class="head"><p>n ligne m colonne</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Acc√®s tableau</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[0][0]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[1][1]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[n</span> <span class="pre">-</span> <span class="pre">1][m</span> <span class="pre">-</span> <span class="pre">1]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Acc√®s pointeur</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*(*(a+0)+0)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*(*(a+1)+1)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*(*(a+i-1)+j-1)</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pointeur-et-chaines-de-caracteres">
<h2><span class="section-number">14.3</span>Pointeur et cha√Ænes de caract√®res<a class="headerlink" href="#pointeur-et-chaines-de-caracteres" title="Lien permanent vers ce titre">¬∂</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">conjonctions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;mais&quot;</span><span class="p">,</span> <span class="s">&quot;ou&quot;</span><span class="p">,</span> <span class="s">&quot;est&quot;</span><span class="p">,</span> <span class="s">&quot;donc&quot;</span><span class="p">,</span> <span class="s">&quot;or&quot;</span><span class="p">,</span> <span class="s">&quot;ni&quot;</span><span class="p">,</span> <span class="s">&quot;car&quot;</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="figure align-default" id="id3">
<img alt="../_images/ptrstr.svg" src="../_images/ptrstr.svg" /><p class="caption"><span class="caption-number">Fig. 14.1 </span><span class="caption-text">Pointeur sur une cha√Æne de caract√®re</span></span><a class="headerlink" href="#id3" title="Lien permanent vers cette image">¬∂</a></p>
</div>
<p>Cette structure est tr√®s exactement la m√™me que pour les arguments transmis √† la fonction <code class="docutils literal notranslate"><span class="pre">main</span></code>: la d√©finition <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*argv[]</span></code>.</p>
</div>
<div class="section" id="structures-et-pointeurs">
<h2><span class="section-number">14.4</span>Structures et pointeurs<a class="headerlink" href="#structures-et-pointeurs" title="Lien permanent vers ce titre">¬∂</a></h2>
<div class="section" id="initialisation-d-un-pointeur-sur-une-structure">
<h3><span class="section-number">14.4.1</span>Initialisation d'un pointeur sur une structure<a class="headerlink" href="#initialisation-d-un-pointeur-sur-une-structure" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>De la m√™me mani√®re qu'avec les types standards, on peut d√©finir un
pointeur sur une structure de donn√©e.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>

  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">jour</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mois</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">annee</span><span class="p">;</span>

<span class="p">}</span> <span class="n">sDate</span><span class="p">,</span> <span class="o">*</span><span class="n">pDate</span><span class="p">;</span>
</pre></div>
</div>
<p>L'exemple pr√©c√©dent d√©finit un type de donn√©e <em>sDate</em> ainsi qu'un
pointeur sur le m√™me type de donn√©e : <em>pDate</em>. On pourrait donc
initialiser un pointeur sur une structure de la fa√ßon suivante :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">sDate</span> <span class="n">date_depart</span><span class="p">;</span>
<span class="n">pDate</span> <span class="n">p</span><span class="p">;</span>            <span class="c1">// pointeur sur un type sDate</span>

<span class="n">p</span><span class="o">=&amp;</span><span class="n">date_depart</span><span class="p">;</span>     <span class="c1">// initialisation du pointeur sur un type structur√©</span>
</pre></div>
</div>
</div>
<div class="section" id="utilisation-d-un-pointeur-sur-une-structure">
<h3><span class="section-number">14.4.2</span>Utilisation d'un pointeur sur une structure<a class="headerlink" href="#utilisation-d-un-pointeur-sur-une-structure" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>On a vu que les champs d'une structure sont accessibles au travers du
<span class="math notranslate nohighlight">\(.\)</span> faisant la liaison entre la variable et le champs. Cela est
valable si la variable est du type structur√©. Si la variable est du type
pointeur sur une structure, on remplacera le <span class="math notranslate nohighlight">\(.\)</span> par <span class="math notranslate nohighlight">\(-&gt;\)</span>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">sDate</span> <span class="n">date_depart</span><span class="p">;</span>
<span class="n">pDate</span> <span class="n">p</span><span class="p">;</span>            <span class="c1">// pointeur sur un type sDate</span>

<span class="n">p</span><span class="o">=&amp;</span><span class="n">date_depart</span><span class="p">;</span>     <span class="c1">// initialisation du pointeur sur un type structur√©</span>

<span class="n">p</span><span class="o">-&gt;</span><span class="n">jour</span><span class="o">=</span><span class="mi">29</span><span class="p">;</span>         <span class="c1">// acc√®s aux champs de la structure</span>
<span class="n">p</span><span class="o">-&gt;</span><span class="n">mois</span><span class="o">=</span><span class="mi">12</span><span class="p">;</span>         <span class="c1">// depuis  un pointeur</span>
<span class="n">p</span><span class="o">-&gt;</span><span class="n">annee</span><span class="o">=</span><span class="mi">1964</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="utilisation-d-un-pointeur-recursif-sur-une-structure">
<h3><span class="section-number">14.4.3</span>Utilisation d'un pointeur r√©cursif sur une structure<a class="headerlink" href="#utilisation-d-un-pointeur-recursif-sur-une-structure" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>Lorsqu'on utilise des listes cha√Æn√©es, on a besoin de cr√©er une
structure contenant des donn√©es ainsi qu'un pointeur sur un √©l√©ment
pr√©c√©dent et un autre sur l'√©l√©ment suivant. Ces pointeurs sont du m√™me
type que la structure dans laquelle ils sont d√©clar√©s et cela impose un
style d'√©criture sp√©cifique :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">sElement</span> <span class="p">{</span>

  <span class="k">struct</span> <span class="n">sElement</span> <span class="o">*</span><span class="n">precedent</span><span class="p">;</span> <span class="c1">// pointeur sur l&#39;√©l√©ment pr√©c√©dent</span>
  <span class="k">struct</span> <span class="n">sElement</span> <span class="o">*</span><span class="n">suivant</span><span class="p">;</span>   <span class="c1">// pointeur sur l&#39;√©l√©ment suivant</span>

  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">;</span>  <span class="c1">// donn√©e de la liste cha√Æn√©e</span>

<span class="p">}</span> <span class="n">sElement</span><span class="p">,</span> <span class="o">*</span><span class="n">pElement</span><span class="p">;</span>
</pre></div>
</div>
<p>Exemple d'utilisation :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">sElement</span> <span class="n">e</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="c1">// 3 √©l√©ments dans la liste</span>

<span class="c1">// premier √©l√©ment de la liste</span>
<span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">precedent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">suivant</span>   <span class="o">=</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="c1">// second √©l√©ment de la liste</span>
<span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">precedent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">suivant</span>   <span class="o">=</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="c1">// troisi√®me √©l√©ment de la liste</span>
<span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">precedent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">suivant</span>   <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="pointeurs-et-parametres-de-fonctions">
<h3><span class="section-number">14.4.4</span>Pointeurs et param√®tres de fonctions<a class="headerlink" href="#pointeurs-et-parametres-de-fonctions" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>Les fonctions comportent une liste de param√®tres permettant de retourner
une information au programme appelant. Il est souvent indispensable de
pouvoir fournir √† une fonction des param√®tres qu'elle peut modifier lors
de son ex√©cution. Pour se faire, on passera par l'utilisation de
pointeurs.</p>
</div>
<div class="section" id="parametres-sous-la-forme-de-pointeurs">
<h3><span class="section-number">14.4.5</span>Param√®tres sous la forme de pointeurs<a class="headerlink" href="#parametres-sous-la-forme-de-pointeurs" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>Le prototype d'une fonction recevant un (ou plusieurs) pointeurs s'√©crit
de la mani√®re suivante :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">type</span> <span class="nf">fonction</span><span class="p">(</span><span class="n">type</span> <span class="o">*</span> <span class="n">param</span><span class="p">);</span>
</pre></div>
</div>
<p>Cette fonction re√ßoit un param√®tre (<em>param</em>) qui est un pointeur sur un
type particulier.</p>
<p>Exemple de prototype :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">calcul</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span> <span class="n">pres</span><span class="p">);</span>
</pre></div>
</div>
<p>La fonction <em>calcul</em> prend 2 param√®tres. Le premier (<em>x</em>) est du type
double. Le second (<em>pres</em>) est un pointeur sur un double. Il sera donc
possible, lors de l'appel de la fonction, de lui donner l'adresse d'une
variable dans laquelle la fonction placera le r√©sultat du calcul.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">calcul</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span> <span class="n">pres</span><span class="p">)</span> <span class="p">{</span>

  <span class="o">*</span><span class="n">pres</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">;</span>  <span class="c1">// calcul du double de x</span>
                  <span class="c1">// place le resultat √† l&#39;adresse pres</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>       <span class="c1">// code retour = 0 (int)</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="kt">double</span> <span class="n">valeur</span> <span class="o">=</span> <span class="mf">7.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">code_ret</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="n">code_ret</span><span class="o">=</span><span class="n">calcul</span> <span class="p">(</span><span class="n">valeur</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">);</span>
  <span class="c1">// r vaut maintenant 14.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Lors de l'appel d'une fonction recevant un pointeur comme param√®tre, on
placera le symbole &amp; pour lui donner l'adresse de la variable.</p>
</div>
</div>
<div class="section" id="transtypage-de-pointeurs-cast">
<h2><span class="section-number">14.5</span>Transtypage de pointeurs (cast)<a class="headerlink" href="#transtypage-de-pointeurs-cast" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>Le <code class="docutils literal notranslate"><span class="pre">cast</span></code> de pointeur s'av√®re n√©cessaire lorsqu'un pointeur du type <code class="docutils literal notranslate"><span class="pre">void</span></code> est d√©clar√©, comme c'est le cas pour la fonction de copie m√©moire <code class="docutils literal notranslate"><span class="pre">memcpy</span></code>. En effet, cette fonction accepte en entr√©e un pointeur vers une r√©gion m√©moire source, et un pointeur vers une r√©gion m√©moire de destination. D'un cas d'utilisation √† un autre, le format de ces r√©gions m√©moires peut √™tre de nature tr√®s diff√©rente :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="n">message</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;Mind the gap, please!&quot;</span><span class="p">;</span>

<span class="nb">int</span> <span class="n">array</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>

<span class="n">struct</span> <span class="p">{</span> <span class="nb">int</span> <span class="n">a</span><span class="p">;</span> <span class="n">char</span> <span class="n">b</span><span class="p">;</span> <span class="nb">float</span> <span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">}</span> <span class="n">elements</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
</pre></div>
</div>
<p>Il faudrait donc autant de fonction <code class="docutils literal notranslate"><span class="pre">memcpy</span></code> que de type possible, ce qui n'est ni raisonnable, ni m√™me imaginable. Face √† ce dilemme, on utilise un pointeur neutre, celui qui n'envie personne et que personne n'envie <code class="docutils literal notranslate"><span class="pre">void</span></code> et qui permet sans autre :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>

<span class="n">ptr</span> <span class="o">=</span> <span class="n">message</span><span class="p">;</span>
<span class="n">ptr</span> <span class="o">=</span> <span class="n">array</span><span class="p">;</span>
<span class="n">ptr</span> <span class="o">=</span> <span class="n">elements</span><span class="p">;</span>
</pre></div>
</div>
<p>Que pensez-vous que <code class="docutils literal notranslate"><span class="pre">sizeof(void)</span></code> devrait retourner ? Formellement ceci devrait mener √† une erreur de compilation, car <code class="docutils literal notranslate"><span class="pre">void</span></code> n'a pas de substance, et donc aucune taille associ√©e. N√©anmoins <code class="docutils literal notranslate"><span class="pre">gcc</span></code> est tr√®s permissif de base et (√† ma <a class="reference external" href="https://stackoverflow.com/questions/1666224/what-is-the-size-of-void">grande surprise</a>), il ne g√©n√®re par d√©faut ni <em>warning</em>, ni erreurs sans l'option <code class="docutils literal notranslate"><span class="pre">-Wpointer-arith</span></code> sur laquelle nous aurons tout le loisir de revenir.</p>
<p>L'int√©r√™t d'un pointeur, c'est justement de pointer une r√©gion m√©moire et le plus souvent, de la balayer gr√¢ce √† l'arithm√©tique de pointeurs. Notre fonction de copie m√©moire doit en somme pouvoir parcourir toute la r√©gion m√©moire de source et de destination et de ce fait incr√©menter le pointeur. Mais, n'ayant aucune taille l'arithm√©tique de pointeur n'est pas autoris√©e avec le pointeur <code class="docutils literal notranslate"><span class="pre">void</span></code> et nous voil√† bien avanc√©s, notre pointeur ne nous est gu√®re d'usage que son utilit√© √©ponyme: rien.</p>
<p>Or, le titre de cette section √©tant le transtypage, il doit donc y avoir moyen de s'en sortir par une pirouette programmatique dans laquelle je d√©clare un nouveau pointeur du type char auquel j'associe la valeur de ptr par un <strong>cast explicite</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="o">*</span><span class="n">iptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">char</span><span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">;</span>
</pre></div>
</div>
<p>D√®s lors, l'arithm√©tique est redevient possible <code class="docutils literal notranslate"><span class="pre">iptr++</span></code>. Pourquoi ne pas avoir utilis√© ce subterfuge plus t√¥t me direz-vous ? En effet, il m'aurait √©t√© possible d'√©crire <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*ptr</span> <span class="pre">=</span> <span class="pre">(char*)elements;</span></code> directement et sans d√©tour, mais ceci aurait alors men√© √† ce prototype-ci :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="o">*</span><span class="n">memcpy</span><span class="p">(</span><span class="n">char</span><span class="o">*</span> <span class="n">dest</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">n</span><span class="p">);</span>
</pre></div>
</div>
<p>La cl√© est dans le standard ISO/IEC 9899:2011 section 6.3.2.3 page 55 :</p>
<blockquote>
<div><p>A pointer to void may be converted to or from a pointer to any object type. A pointer to any object type may be converted to a pointer to void and back again; the result shall compare equal to the original pointer.</p>
</div></blockquote>
<p>Autrement dit, il n'est pas n√©cessaire, ni recommand√© de faire un transtypage explicite pour convertir vers et en provenance d'un pointeur sur <code class="docutils literal notranslate"><span class="pre">void</span></code>. Et donc, l'astuce de memcpy est que la fonction accepte n'importe quel type de pointeur et c'est le message autodocument√© du code.</p>
<p>Et quant √† l'impl√©mentation de cette fonction me direz-vous ? Une possibilit√© serait :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">memcpy</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">char</span><span class="o">*</span> <span class="n">csrc</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
    <span class="n">char</span><span class="o">*</span> <span class="n">cdest</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">cdest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">csrc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>O√π plus concis :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">memcpy</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">((</span><span class="n">char</span><span class="o">*</span><span class="p">)</span><span class="n">dst</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">char</span><span class="o">*</span><span class="p">)</span><span class="n">src</span><span class="p">)[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or, rien de tout ceci n'est juste. <code class="docutils literal notranslate"><span class="pre">memcpy</span></code> est une fonction fondamentale en C, ce pourquoi nous nous y attardons temps. Elle est constamment utilis√©e et doit √™tre extr√™mement performante. Aussi, si le compilateur cible une architecture 64-bits pourquoi diable copier les √©l√©ments par paquet de 8-bits. C'est un peu comme si notre facteur, au d√©but de ce chapitre, aurait fait ses allers-retours avec en t√™te qu'un octet par trajet. L'impl√©mentation d√©pend donc de l'architecture cible et doit tenir compte des √©ventuels effets de bords. Par exemple s'il faut copier un tableau de 9 x 32 bits. Une architecture 64-bits aura une grande facilit√© √† copier les 8 premiers octets, mais quant au dernier, il s'agit d'un cas particulier et selon la taille de la copie et l'architecture du processeur, l'impl√©mentation devra √™tre ajust√©e. C'est pourquoi ce type tr√®s bas niveau de fonction est l'affaire d'une cuisine interne du compilateur et dont le d√©veloppeur ne doit pas se soucier. Vous √™tes comme <a class="reference external" href="https://fr.wikipedia.org/wiki/Thomas_(ap%C3%B4tre)">Thomas l'ap√¥tre</a>, et ne me croyez pas ? Alors, digressons et essayons :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">a</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;La Broye c&#39;est fantastique!&quot;</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">b</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">)];</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s %s&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>On observe qu'il n'y a aucun appel de fonction √† <code class="docutils literal notranslate"><span class="pre">memcpy</span></code> comme c'est le cas pour <code class="docutils literal notranslate"><span class="pre">printf</span></code> (<code class="docutils literal notranslate"><span class="pre">bl</span> <span class="pre">printf</span></code>). La copie tient place en 6 instructions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>main :
    // Entry
    str     lr, [sp, #-4]!
    sub     sp, sp, #60

    // Inline memcpy
    mov     ip, sp                  // Destination address
    add     lr, sp, #28             // Source address (char b located 28 octets after a)

    ldmia   lr!, {r0, r1, r2, r3}   // Load 4 x 32-bits
    stmia   ip!, {r0, r1, r2, r3}   // Store 4 x 32-bits

    ldm     lr, {r0, r1, r2}        // Load 3 x 32-bits
    stm     ip, {r0, r1, r2}        // Store 3 x 32-bits

    // Display (printf)
    add     r2, sp, #28
    mov     r1, sp
    ldr     r0, .L4
    bl      printf

    // Exit
    mov     r0, #0
    add     sp, sp, #60
    ldr     pc, [sp], #4
.L4 :
    .word   .LC0
.LC0 :
    .ascii  &quot;La Broye c&#39;est fantastique!\000&quot;
</pre></div>
</div>
<p>Vous pouvez jouer avec cet exemple <a class="reference external" href="https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,lang:c%2B%2B,source:'%23include+%3Cstring.h%3E%0A%23include+%3Cstdio.h%3E%0A%0Aint+main(void)%0A%7B%0A++++char+a%5B%5D+%3D+%22La+Broye+c!'est+fantastique!!%22%3B%0A++++char+b%5Bsizeof(a)%5D%3B%0A%0A++++memcpy(a,+b,+sizeof(a))%3B%0A%0A++++printf(%22%25s+%25s%22,+a,+b)%3B%0A%7D'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:armg820,filters:(b:'0',binary:'1',commentOnly:'0',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'1',trim:'1'),lang:c%2B%2B,libs:!(),options:'-O2',source:1),l:'5',n:'0',o:'ARM+gcc+8.2+(Editor+%231,+Compiler+%231)+C%2B%2B',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4">ici</a>.</p>
</div>
<div class="section" id="pointeurs-de-fonctions">
<h2><span class="section-number">14.6</span>Pointeurs de fonctions<a class="headerlink" href="#pointeurs-de-fonctions" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>Un pointeur peut pointer n'importe ou en m√©moire, et donc il peut √©galement pointer non pas sur une variable, mais sur une fonction. Les pointeurs de fonctions sont tr√®s utiles pour des fonctions de rappel (<a class="reference external" href="https://fr.wikipedia.org/wiki/Fonction_de_rappel">callback</a>).</p>
<p>Par exemple on veut appliquer une transformation sur tous les √©l√©ments d'un tableau, mais la transformation n'est pas connue √† l'avance. On pourrait √©crire :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">is_odd</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">map</span><span class="p">(</span><span class="kt">int</span> <span class="n">array</span><span class="p">[],</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">int</span><span class="p">),</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">array</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">};</span>

    <span class="n">map</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">is_odd</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Avec la r√®gle gauche droite on parvient √† d√©cortiquer la d√©claration :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">int</span><span class="p">)</span>
      <span class="o">^^^^^^^^</span>        <span class="n">callback</span> <span class="n">is</span>
              <span class="o">^</span>
     <span class="o">^</span>                <span class="n">a</span> <span class="n">pointer</span> <span class="n">on</span>
               <span class="o">^^^^^</span>  <span class="n">a</span> <span class="n">function</span> <span class="n">taking</span> <span class="n">an</span> <span class="kt">int</span>
<span class="o">^^^</span>                   <span class="n">and</span> <span class="n">returning</span> <span class="n">an</span> <span class="kt">int</span>
</pre></div>
</div>
</div>
<div class="section" id="la-regle-gauche-droite">
<h2><span class="section-number">14.7</span>La r√®gle gauche-droite<a class="headerlink" href="#la-regle-gauche-droite" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>Cette <a class="reference external" href="http://cseweb.ucsd.edu/~ricko/rt_lt.rule.html">r√®gle</a> est une recette magique permettant de correctement d√©cortiquer une d√©claration C contenant des pointeurs.</p>
<p>Il faut tout d'abord lire :</p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-number">Tableau 14.3 </span><span class="caption-text">R√®gles gauche droite</span><a class="headerlink" href="#id4" title="Lien permanent vers ce tableau">¬∂</a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 47%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbole</p></th>
<th class="head"><p>Traduction</p></th>
<th class="head"><p>Direction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pointeur</span> <span class="pre">sur</span></code></p></td>
<td><p>Toujours √† gauche</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tableau</span> <span class="pre">de</span></code></p></td>
<td><p>Toujours √† droite</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fonction</span> <span class="pre">retournant</span></code></p></td>
<td><p>Toujours √† droite</p></td>
</tr>
</tbody>
</table>
<div class="section" id="premiere-etape">
<h3><span class="section-number">14.7.1</span>Premi√®re √©tape<a class="headerlink" href="#premiere-etape" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>Trouver l'identifiant et se dire <code class="docutils literal notranslate"><span class="pre">L'identifiant</span> <span class="pre">est</span></code>.</p>
</div>
<div class="section" id="deuxieme-etape">
<h3><span class="section-number">14.7.2</span>Deuxi√®me √©tape<a class="headerlink" href="#deuxieme-etape" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>Chercher le symbole √† droite de l'identifiant. Si vous trouvez un <code class="docutils literal notranslate"><span class="pre">()</span></code>, vous savez que cet identifiant est une fonction et vous avez <code class="docutils literal notranslate"><span class="pre">L'identifiant</span> <span class="pre">est</span> <span class="pre">une</span> <span class="pre">fonction</span> <span class="pre">retournant</span></code>. Si vous trouvez un <code class="docutils literal notranslate"><span class="pre">[]</span></code> vous dites alors <code class="docutils literal notranslate"><span class="pre">L'identifiant</span> <span class="pre">est</span> <span class="pre">un</span> <span class="pre">tableau</span> <span class="pre">de</span></code>. Continuez √† droite jusqu'√† ce que vous √™tes √† court de symboles, <strong>OU</strong> que vous trouvez une parenth√®se fermante <code class="docutils literal notranslate"><span class="pre">)</span></code>.</p>
</div>
<div class="section" id="troisieme-etape">
<h3><span class="section-number">14.7.3</span>Troisi√®me √©tape<a class="headerlink" href="#troisieme-etape" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>Regardez le symbole √† gauche de l'identifiant. S‚Äôil n'est aucun des symboles pr√©c√©dents, dites quelque chose comme <code class="docutils literal notranslate"><span class="pre">int</span></code>. Sinon, convertissez le symbole en utilisant la table de correspondance. Continuez d'aller √† <strong>gauche</strong> jusqu'√† ce que vous √™tes √† court de symboles <strong>OU</strong> que vous rencontrez une parenth√®se ouvrante <code class="docutils literal notranslate"><span class="pre">(</span></code>.</p>
<p>Continuez les √©tapes 2 et 3 jusqu'√† ce que vous avez une d√©claration compl√®te.</p>
</div>
<div class="section" id="exemples">
<h3><span class="section-number">14.7.4</span>Exemples<a class="headerlink" href="#exemples" title="Lien permanent vers ce titre">¬∂</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">[];</span>
</pre></div>
</div>
<ol class="arabic">
<li><p>Trouver l'identifiant: <code class="docutils literal notranslate"><span class="pre">p</span></code>: <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">est</span></code></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">[];</span>
     <span class="o">^</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Se d√©placer √† <strong>droite</strong>: <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">est</span> <span class="pre">un</span> <span class="pre">tableau</span> <span class="pre">de</span></code></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">[];</span>
      <span class="o">^^</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Se d√©placer √† <strong>gauche</strong>: <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">est</span> <span class="pre">un</span> <span class="pre">tableau</span> <span class="pre">de</span> <span class="pre">pointeurs</span> <span class="pre">sur</span></code></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">[];</span>
    <span class="o">^</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Continuer √† <strong>gauche</strong>: <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">est</span> <span class="pre">un</span> <span class="pre">tableau</span> <span class="pre">de</span> <span class="pre">pointeurs</span> <span class="pre">sur</span> <span class="pre">un</span> <span class="pre">int</span></code></p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">[];</span>
<span class="o">^^^</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="cdecl">
<h3><span class="section-number">14.7.5</span>cdecl<a class="headerlink" href="#cdecl" title="Lien permanent vers ce titre">¬∂</a></h3>
<p>Il existe un programme nomm√© <a class="reference external" href="https://github.com/paul-j-lucas/cdecl">cdecl</a> qui permet de d√©coder de complexes d√©claration c :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cdecl <span class="s1">&#39;char (*(*x[3])())[5]&#39;</span>
<span class="go">declare x as array 3 of pointer to function returning pointer to array 5 of char</span>
</pre></div>
</div>
<p>Une version en-ligne est √©galement <a class="reference external" href="https://cdecl.org/">disponible</a>.</p>
</div>
</div>
<div class="section" id="initialisation-par-transtypage">
<h2><span class="section-number">14.8</span>Initialisation par transtypage<a class="headerlink" href="#initialisation-par-transtypage" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>L'utilisation de structure peut √™tre utile pour initialiser un type de donn√©e en utilisant un autre type de donn√©e. Nous citons ici deux exemples.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)(</span><span class="k">struct</span> <span class="p">{</span> <span class="kt">char</span> <span class="n">a</span><span class="p">;</span> <span class="kt">char</span> <span class="n">b</span><span class="p">;</span> <span class="kt">char</span> <span class="n">c</span><span class="p">;</span> <span class="kt">char</span> <span class="n">d</span><span class="p">;</span> <span class="p">}){</span><span class="sc">&#39;a&#39;</span><span class="p">,</span> <span class="sc">&#39;b&#39;</span><span class="p">,</span> <span class="sc">&#39;c&#39;</span><span class="p">,</span> <span class="sc">&#39;d&#39;</span><span class="p">};</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">union</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">matrix</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">10</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">vector</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
<span class="p">}</span> <span class="n">data</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="enchevetrement-ou-aliasing">
<h2><span class="section-number">14.9</span>Enchev√™trement ou <em>Aliasing</em><a class="headerlink" href="#enchevetrement-ou-aliasing" title="Lien permanent vers ce titre">¬∂</a></h2>
<p>Travailler avec les pointeurs demande une attention particuli√®re √† tous
les probl√®me d'<em>alisasing</em> dans lesquels diff√©rents pointeurs pointent sur
une m√™me r√©gion m√©moire.</p>
<p>Mettons que l'on souhaite simplement d√©placer une r√©gion m√©moire vers une nouvelle r√©gion m√©moire. On pourrait impl√©menter le code suivant :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">memory_move</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ce code est tr√®s simple mais il peut poser probl√®me selon les cas. Imaginons que l'on dispose d'un tableau simple de dix √©l√©ments et de deux pointeurs <code class="docutils literal notranslate"><span class="pre">*src</span></code> et <code class="docutils literal notranslate"><span class="pre">*dst</span></code>. Pour d√©placer la r√©gion du tableau de 4 √©l√©ments vers la droite. On se dirait que le code suivant pourrait fonctionner :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>‚îå‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îê
‚îÇ0‚îÇ1‚îÇ2‚îÇ3‚îÇ4‚îÇ5‚îÇ6‚îÇ7‚îÇ8‚îÇ9‚îÇ
‚îî‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îò
 ^*src ^*dst
      ‚îå‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îê
      ‚îÇ0‚îÇ1‚îÇ2‚îÇ3‚îÇ4‚îÇ5‚îÇ6‚îÇ
      ‚îî‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îò
       ‚Üì ‚Üì ‚Üì ‚Üì ‚Üì ‚Üì ‚Üì
‚îå‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îê
‚îÇ0‚îÇ1‚îÇ2‚îÇ0‚îÇ1‚îÇ2‚îÇ3‚îÇ4‚îÇ5‚îÇ6‚îÇ
‚îî‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îò
</pre></div>
</div>
<p>Na√Øvement l'ex√©cution suivante devrait fonctionner, mais les deux pointeurs source et destination s'enchev√™trent et le r√©sultat n'est pas celui escompt√©.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">array</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">};</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">src</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">dst</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">array</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

<span class="n">memory_move</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>‚îå‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îê
‚îÇ0‚îÇ1‚îÇ2‚îÇ3‚îÇ4‚îÇ5‚îÇ6‚îÇ7‚îÇ8‚îÇ9‚îÇ Tableau d&#39;origine
‚îî‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îò
‚îå‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îê
‚îÇ0‚îÇ1‚îÇ2‚îÇ0‚îÇ1‚îÇ2‚îÇ0‚îÇ1‚îÇ2‚îÇ0‚îÇ Op√©ration avec `memory_move`
‚îî‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îò
‚îå‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îê
‚îÇ0‚îÇ1‚îÇ2‚îÇ0‚îÇ1‚îÇ2‚îÇ3‚îÇ4‚îÇ5‚îÇ6‚îÇ Op√©ration avec `memmove` (fonction standard)
‚îî‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îò
</pre></div>
</div>
<p>Notre simple fonction de d√©placement m√©moire ne fonctionne pas avec des r√©gions m√©moire qui s'enchev√™trent. En revanche, la fonction standard <code class="docutils literal notranslate"><span class="pre">memmove</span></code> de <code class="docutils literal notranslate"><span class="pre">&lt;stdlib.h&gt;</span></code> fonctionne car elle autorise, au d√©triment d'une plus grande complexit√©, de g√©rer ce type de situation.</p>
<p>Notons que sa fonction voisine <code class="docutils literal notranslate"><span class="pre">memcpy</span></code> ne dois <strong>jamais</strong> √™tre utilis√©e en cas d'<em>aliasing</em>. Cette fonction se veut performante, c'est √† dire qu'elle peut √™tre impl√©ment√©e en suivant le m√™me principe que notre exemple <code class="docutils literal notranslate"><span class="pre">memory_move</span></code>. Le standard <strong>C99</strong> ne d√©fini pas le comportement de <code class="docutils literal notranslate"><span class="pre">memcpy</span></code> pour des pointeurs qui se chevauchent.</p>
<hr class="docutils" />
<p><a class="reference external" href="../exercises.html#exercise/14/1">Exercice 14.1</a>: Esperluettes cascad√©es</p>
<p><a class="reference external" href="../exercises.html#exercise/14/2">Exercice 14.2</a>: Passage par adresse</p>
</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="memory-management.html"
       title="Chapitre pr√©c√©dent">‚Üê <span class="section-number">13</span>Gestion de la m√©moire</a>
  </li>
  <li class="next">
    <a href="standard-library.html"
       title="Chapitre suivant"><span class="section-number">15</span>Biblioth√®ques ‚Üí</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright HEIG-VD(c) 2019.
    Mis √† jour le 03 ao√ªt 2020 (version v0.2.7-11-g8c8a2e1).
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0 with <a href="https://github.com/heig-vd-tin/sphinx_heigvd_theme">HEIG-VD Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>