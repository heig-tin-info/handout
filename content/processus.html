<!DOCTYPE html>
<html  lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style type="text/css">
        p.rubric {
            font-weight: bold;
        }

        p.rubric:hover > a.headerlink {
            visibility: visible;
        }
    </style>
    
      <title>8 Programmes et Processus</title>
    
      <link rel="stylesheet" href="../_static/pygments.css">
      <link rel="stylesheet" href="../_static/theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

      
      <script src="../_static/theme-vendors.js"></script>
      <script src="../_static/theme.js" defer></script>
    
    <link rel="icon" href="../_static/favicon.ico" type="image/x-icon" />
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Recherche" href="../search.html" />
  <link rel="next" title="9 Entrées Sorties" href="stdio.html" />
  <link rel="prev" title="7 Structures de contrôle" href="control-structures.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../index.html" class="home-link">
    
      <span class="site-name">Le C pour l&#39;ingénieur</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link  router-link-active">
         Table des matières
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Annexes
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Références
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link  router-link-active">
         Table des matières
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Annexes
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#le-c-pour-l-ingenieur"
         class="nav-link ">
         Références
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Recherche rapide</span>
    <div class="searchformwrapper">
      <form class="search" action="../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Recherche" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#le-c-pour-l-ingenieur">Table des matières</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="introduction.html" class="reference internal ">Introduction</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="programming.html" class="reference internal ">La programmation</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="foundations.html" class="reference internal ">Généralités du langage</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="numeration.html" class="reference internal ">Numération</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="operators.html" class="reference internal ">Opérateurs</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="datatype.html" class="reference internal ">Types de données</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="control-structures.html" class="reference internal ">Structures de contrôle</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">Programmes et Processus</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#qu-est-ce-qu-un-programme" class="reference internal">Qu'est-ce qu'un programme?</a></li>
                
                  <li class="toctree-l2"><a href="#arguments-et-options" class="reference internal">Arguments et options</a></li>
                
                  <li class="toctree-l2"><a href="#fonction-main" class="reference internal">Fonction main</a></li>
                
                  <li class="toctree-l2"><a href="#entrees-sorties-standards" class="reference internal">Entrées sorties standards</a></li>
                
                  <li class="toctree-l2"><a href="#boucle-d-attente" class="reference internal">Boucle d'attente</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 "><a href="stdio.html" class="reference internal ">Entrées Sorties</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="functions.html" class="reference internal ">Fonctions</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="composite-datatypes.html" class="reference internal ">Types composites</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="files.html" class="reference internal ">Les  fichiers</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="memory-management.html" class="reference internal ">Gestion de la mémoire</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="pointers.html" class="reference internal ">Pointeurs</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="standard-library.html" class="reference internal ">Bibliothèques</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="preprocessor.html" class="reference internal ">Préprocesseur</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="algorithms.html" class="reference internal ">Algorithmes et conception</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="translation-units.html" class="reference internal ">Compilation séparée</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="scopes.html" class="reference internal ">Portée et visibilité</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="testing.html" class="reference internal ">Qualité et Testabilité</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="data-structures.html" class="reference internal ">Structures de données</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="advanced-topics.html" class="reference internal ">Avancé</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="traps.html" class="reference internal ">Pièges</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="philosophy.html" class="reference internal ">Philosophie</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#le-c-pour-l-ingenieur">Annexes</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../appendix/vscode.html" class="reference internal ">Visual Studio Code</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/grammar.html" class="reference internal ">Grammaire C</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/bash.html" class="reference internal ">Ligne de commande</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/development.html" class="reference internal ">Environnement de développement</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/unit.html" class="reference internal ">Fiches d'unités de cours</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../appendix/laboratories.html" class="reference internal ">Laboratoires</a>

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#le-c-pour-l-ingenieur">Références</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 "><a href="../backmatter/exercises.html" class="reference internal ">Solution des exercices</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../backmatter/bibliography.html" class="reference internal ">Bibliographie</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../backmatter/glossary.html" class="reference internal ">Glossaire</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
    <li><span class="section-number">8  </span>Programmes et Processus</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="control-structures.html"
       title="Chapitre précédent">← <span class="section-number">7  </span>Structures de contrôle</a>
  </li>
  <li class="next">
    <a href="stdio.html"
       title="Chapitre suivant"><span class="section-number">9  </span>Entrées Sorties →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <div class="section" id="programmes-et-processus">
<h1><span class="section-number">8  </span>Programmes et Processus<a class="headerlink" href="#programmes-et-processus" title="Lien permanent vers ce titre">¶</a></h1>
<div class="figure align-default" id="id1">
<a class="reference internal image-reference" href="../_images/vintage-programmer.jpg"><img alt="../_images/vintage-programmer.jpg" src="../_images/vintage-programmer.jpg" style="width: 319.2px; height: 453.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 8.1 </span><span class="caption-text">Programmeuse en tenue décontractée à côté de 62'500 cartes perforées</span><a class="headerlink" href="#id1" title="Lien permanent vers cette image">¶</a></p>
</div>
<div class="section" id="qu-est-ce-qu-un-programme">
<h2><span class="section-number">8.1  </span>Qu'est-ce qu'un programme?<a class="headerlink" href="#qu-est-ce-qu-un-programme" title="Lien permanent vers ce titre">¶</a></h2>
<p>Un <a class="reference external" href="https://fr.wikipedia.org/wiki/Programme_informatique">programme informatique</a> est un ensemble d'opérations destinées à être exécutées par un ordinateur.</p>
<p>Un programme peut se décliner sous plusieurs formes :</p>
<ul class="simple">
<li><p>Code source</p></li>
<li><p>Listing assembleur</p></li>
<li><p>Exécutable binaire</p></li>
</ul>
<p>Un processus est l'état d'un programme en cours d'exécution. Lorsqu'un programme est exécuté, il devient processus pendant un temps donné. Les <a class="reference external" href="https://fr.wikipedia.org/wiki/Syst%C3%A8me_d%27exploitation">systèmes d'exploitation</a> tels que Windows sont dits <a class="reference external" href="https://fr.wikipedia.org/wiki/Multit%C3%A2che">multitâches</a>, il peuvent par conséquent faire tourner plusieurs processus en parallèle. Le temps processeur est ainsi partagé entre chaque processus.</p>
<div class="section" id="code-source">
<h3><span class="section-number">8.1.1  </span>Code source<a class="headerlink" href="#code-source" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le <strong>code source</strong> est généralement écrit par un ingénieur/développeur/informaticien. Il s'agit le plus souvent d'un fichier texte lisible par un être humain et souvent pourvu de commentaires facilitant sa compréhension. Selon le langage de programmation utilisé, la programmation peut être graphique comme avec les diagrammes <a class="reference external" href="https://fr.wikipedia.org/wiki/Langage_Ladder">Ladder</a> utilisés dans les automates programmables et respectant la norme <a class="reference external" href="https://fr.wikipedia.org/wiki/CEI_61131-3">IEC 61131-3</a>, ou <a class="reference external" href="www.ni.com/en-us/shop/labview.html">LabView</a> un outil de développement graphique.</p>
<p>Le plus souvent le code source est organisé en une <a class="reference external" href="https://fr.wikipedia.org/wiki/Arborescence">arborescence</a> de fichiers. Des programmes complexes comme le noyau Linux contiennent plus de 100'000 fichiers et 10 millions de lignes de code, pour la plupart écrites en C.</p>
</div>
<div class="section" id="executable-binaire">
<h3><span class="section-number">8.1.2  </span>Exécutable binaire<a class="headerlink" href="#executable-binaire" title="Lien permanent vers ce titre">¶</a></h3>
<p>Une fois compilé en <a class="reference external" href="https://fr.wikipedia.org/wiki/Langage_machine">langage machine</a>, il en résulte un fichier qui peut être exécuté soit par un système d'exploitation, soit sur une plateforme embarquée à microcontrôleur sans l'intermédiaire d'un système d'exploitation. On dit que ce type de programme est <a class="reference external" href="https://en.wikipedia.org/wiki/Bare_machine">bare metal</a>, qu'il s'exécute à même le métal.</p>
<p>Un exécutable binaire doit être compilé pour la bonne architecture matérielle. Un programme compilé pour un processeur INTEL ne pourra pas s'exécuter sur un processeur ARM, c'est pourquoi on utilise différents compilateurs en fonctions des architectures cibles. L'opération de compiler un programme pour une autre architecture, ou un autre système d'exploitation que celui sur lequel est installé le compilateur s'appelle la compilation croisée (<a class="reference external" href="https://en.wikipedia.org/wiki/Cross_compiler">cross-compilation</a>).</p>
<p>Prenons l'exemple du programme suivant qui calcule la suite des nombres de Fibonacci :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">next_term</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the number of terms: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Fibonacci Series: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d, &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">next_term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_term</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Une fois <a class="reference external" href="https://fr.wikipedia.org/wiki/Assembly_(informatique)">assemblé</a> le code  source est converti en langage assembleur, une version intermédiaire entre le C et le langage machine. L'exemple est compilé en utilisant gcc :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">gcc Fibonacci.c -o fibonacci.exe</span>
<span class="go">objdump -d fibonacci.exe</span>
</pre></div>
</div>
<p>On obtiens un fichier similaire à ceci qui contient le code machine (<code class="docutils literal notranslate"><span class="pre">48</span> <span class="pre">83</span> <span class="pre">ec</span> <span class="pre">20</span></code>), et l'équivalent en langage assembleur (<code class="docutils literal notranslate"><span class="pre">mov</span>&#160;&#160;&#160; <span class="pre">%fs:0x28,%rax</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">0000000000000680 &lt;main&gt;:</span>
<span class="go">680:   41 55                   push   %r13</span>
<span class="go">682:   41 54                   push   %r12</span>
<span class="go">684:   48 8d 35 59 02 00 00    lea    0x259(%rip),%rsi</span>
<span class="go">68b:   55                      push   %rbp</span>
<span class="go">68c:   53                      push   %rbx</span>
<span class="go">68d:   bf 01 00 00 00          mov    $0x1,%edi</span>
<span class="go">692:   48 83 ec 18             sub    $0x18,%rsp</span>
<span class="go">696:   64 48 8b 04 25 28 00    mov    %fs:0x28,%rax</span>
<span class="go">69d:   00 00</span>
<span class="go">69f:   48 89 44 24 08          mov    %rax,0x8(%rsp)</span>
<span class="go">6a4:   31 c0                   xor    %eax,%eax</span>
<span class="go">6a6:   e8 a5 ff ff ff          callq  650 &lt;__printf_chk@plt&gt;</span>
<span class="go">6ab:   48 8d 74 24 04          lea    0x4(%rsp),%rsi</span>
<span class="go">6b0:   48 8d 3d 49 02 00 00    lea    0x249(%rip),%rdi</span>
<span class="go">6b7:   31 c0                   xor    %eax,%eax</span>
<span class="go">6b9:   e8 a2 ff ff ff          callq  660 &lt;__isoc99_scanf@plt&gt;</span>
<span class="go">6be:   48 8d 35 3e 02 00 00    lea    0x23e(%rip),%rsi</span>
<span class="go">...</span>
<span class="go">72e:   00 00</span>
<span class="go">730:   75 0b                   jne    73d &lt;main+0xbd&gt;</span>
<span class="go">732:   48 83 c4 18             add    $0x18,%rsp</span>
<span class="go">736:   5b                      pop    %rbx</span>
<span class="go">737:   5d                      pop    %rbp</span>
<span class="go">738:   41 5c                   pop    %r12</span>
<span class="go">73a:   41 5d                   pop    %r13</span>
<span class="go">73c:   c3                      retq</span>
<span class="go">73d:   e8 fe fe ff ff          callq  640 &lt;__stack_chk_fail@plt&gt;</span>
<span class="go">742:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)</span>
<span class="go">749:   00 00 00</span>
<span class="go">74c:   0f 1f 40 00             nopl   0x0(%rax)</span>
</pre></div>
</div>
<p>Avec un visualiseur hexadécimal, on peut extraire le langage machine du binaire exécutable. L'utilitaire <code class="docutils literal notranslate"><span class="pre">hexdump</span></code> est appelé avec deux options <code class="docutils literal notranslate"><span class="pre">-s</span></code> pour spécifier l'adresse de début, on choisi ici celle du début de la fonction <code class="docutils literal notranslate"><span class="pre">main</span></code> <code class="docutils literal notranslate"><span class="pre">0x680</span></code>, et <code class="docutils literal notranslate"><span class="pre">-n</span></code> pour n'extraire que les premiers 256 octets :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>hexdump -s0x680 -n256 a.out
<span class="go">0000680 5541 5441 8d48 5935 0002 5500 bf53 0001</span>
<span class="go">0000690 0000 8348 18ec 4864 048b 2825 0000 4800</span>
<span class="go">00006a0 4489 0824 c031 a5e8 ffff 48ff 748d 0424</span>
<span class="go">00006b0 8d48 493d 0002 3100 e8c0 ffa2 ffff 8d48</span>
<span class="go">00006c0 3e35 0002 3100 bfc0 0001 0000 7fe8 ffff</span>
<span class="go">00006d0 8bff 2444 8504 74c0 4c3d 2d8d 0236 0000</span>
<span class="go">00006e0 bc41 0001 0000 01bd 0000 3100 0fdb 001f</span>
<span class="go">00006f0 da89 c031 894c bfee 0001 0000 8349 01c4</span>
<span class="go">0000700 4be8 ffff 8dff 2b04 eb89 c589 6348 2444</span>
<span class="go">0000710 4c04 e039 da73 0abf 0000 e800 ff10 ffff</span>
<span class="go">0000720 c031 8b48 244c 6408 3348 250c 0028 0000</span>
<span class="go">0000730 0b75 8348 18c4 5d5b 5c41 5d41 e8c3 fefe</span>
<span class="go">0000740 ffff 2e66 1f0f 0084 0000 0000 1f0f 0040</span>
<span class="go">0000750 ed31 8949 5ed1 8948 48e2 e483 50f0 4c54</span>
<span class="go">0000760 058d 016a 0000 8d48 f30d 0000 4800 3d8d</span>
<span class="go">0000770 ff0c ffff 15ff 0866 0020 0ff4 441f 0000</span>
</pre></div>
</div>
<p>Il est facile de voir la correspondance entre l'assembleur et l'exécutable binaire. Les valeurs <code class="docutils literal notranslate"><span class="pre">41</span> <span class="pre">55</span></code> puis <code class="docutils literal notranslate"><span class="pre">41</span> <span class="pre">54</span></code> puis <code class="docutils literal notranslate"><span class="pre">48</span> <span class="pre">8d</span> <span class="pre">35</span> <span class="pre">59</span></code> se retrouvent directement dans le <em>dump</em>: <code class="docutils literal notranslate"><span class="pre">5541</span> <span class="pre">5441</span> <span class="pre">8d48</span></code>. Si les valeurs sont interverties c'est parce qu'un PC est <em>little-endian</em> (c.f. <a class="reference internal" href="datatype.html#endianess"><span class="std std-numref">Section 6.3</span></a>), les octets de poids faible apparaissent par conséquent en premier dans la mémoire.</p>
<p>Sous Windows, l'extension des fichiers détermine leur type. Un fichier avec l'extension <code class="docutils literal notranslate"><span class="pre">.jpg</span></code> sera un fichier image du <a class="reference external" href="https://fr.wikipedia.org/wiki/JPEG">Join Photographic Experts Group</a> et exécuter ce fichier correspond à l'ouvrir en utilisant l'application par défaut pour visualiser les images de ce type. Un fichier avec l'extension <code class="docutils literal notranslate"><span class="pre">.exe</span></code> est un exécutable binaire, et il sera exécuté en tant que programme par le système d'exploitation.</p>
<p>Sous POSIX (Linux, macOS, UNIX), les <em>flags</em> d'un fichier qualifient son type. Le programme <code class="docutils literal notranslate"><span class="pre">ls</span></code> permet de visualiser les flags du programme <code class="docutils literal notranslate"><span class="pre">Fibonacci</span></code> que nous avons compilé:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -al a.out
<span class="go">-rwxr-xr-x 1 root ftp 8.3K Jul 17 09:53 Fibonacci</span>
</pre></div>
</div>
<p>Les lettres <code class="docutils literal notranslate"><span class="pre">r-x</span></code> indiquent :</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">r</span></code></dt><dd><p>Lecture autorisée</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">w</span></code></dt><dd><p>Écriture autorisée</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">x</span></code></dt><dd><p>Exécution autorisée</p>
</dd>
</dl>
<p>Ce programme peut-être exécuté par tout le monde, mais modifié que par l'utilisateur <code class="docutils literal notranslate"><span class="pre">root</span></code>.</p>
</div>
<div class="section" id="entrees-sorties">
<span id="inputs-outputs"></span><h3><span class="section-number">8.1.3  </span>Entrées sorties<a class="headerlink" href="#entrees-sorties" title="Lien permanent vers ce titre">¶</a></h3>
<p>Tout programme doit pouvoir interagir avec son environnement. À l'époque des téléscripteurs, un programme interagissait avec un clavier et une imprimante matricielle. Avec l'arrivée des systèmes d'exploitation, le champ d'action fut réduit à des entrées :</p>
<ul class="simple">
<li><p>L'entrée standard <code class="docutils literal notranslate"><span class="pre">STDIN</span></code> fourni au programme du contenu qui est généralement fourni par la sortie d'un autre programme.</p></li>
<li><p>Les arguments du programme <code class="docutils literal notranslate"><span class="pre">ARGV</span></code></p></li>
<li><p>Les variables d'environnement <code class="docutils literal notranslate"><span class="pre">ENVP</span></code></p></li>
</ul>
<p>Ainsi qu'à des sorties :</p>
<ul class="simple">
<li><p>La sortie standard <code class="docutils literal notranslate"><span class="pre">STDOUT</span></code> est généralement affichée à l'écran</p></li>
<li><p>La sortie d'erreur standard <code class="docutils literal notranslate"><span class="pre">STDERR</span></code> contient des détails sur les éventuelles erreurs d'exécution du programme.</p></li>
</ul>
<p>La figure suivante résume les interactions qu'un programme peut avoir sur son environnement. Les appels système (<a class="reference external" href="https://fr.wikipedia.org/wiki/Appel_syst%C3%A8me">syscall</a>) sont des ordres transmis directement au système d'exploitation. Ils permettent par exemple de lire des fichiers, d'écrire à l'écran, de mettre le programme en pause ou de terminer le programme.</p>
<div class="figure align-default" id="id2">
<img alt="../_images/program.svg" src="../_images/program.svg" /><p class="caption"><span class="caption-number">Fig. 8.2 </span><span class="caption-text">Résumé des interactions avec un programme</span><a class="headerlink" href="#id2" title="Lien permanent vers cette image">¶</a></p>
</div>
</div>
<div class="section" id="signaux">
<span id="signals"></span><h3><span class="section-number">8.1.4  </span>Signaux<a class="headerlink" href="#signaux" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lorsqu'un programme est en cours d'exécution, il peut recevoir de la part du système d'exploitation des <a class="reference external" href="https://fr.wikipedia.org/wiki/Signal_(informatique)">signaux</a>. Il s'agit d'une notification asynchrone envoyée à un processus pour lui signaler l'apparition d'un évènement.</p>
<p>Si, en utilisant Windows, vous vous rendez dans le <a class="reference external" href="https://fr.wikipedia.org/wiki/Gestionnaire_des_t%C3%A2ches_Windows">gestionnaire de tâches</a> et que vous décider de <em>Terminer une tâche</em>, le système d'exploitation envoie un signal au programme lui demandant de se terminer.</p>
<p>Sous Linux, habituellement, le <em>shell</em> relie certains raccourcis clavier à des signaux particuliers :</p>
<ul class="simple">
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">c</kbd></kbd> envoie le signal <code class="docutils literal notranslate"><span class="pre">SIGINT</span></code> pour interrompre l'exécution d'un programme</p></li>
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">z</kbd></kbd> envoie le signal <code class="docutils literal notranslate"><span class="pre">SIGTSTP</span></code> pour suspendre l'exécution d'un programme</p></li>
<li><p><kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">t</kbd></kbd> envoie le signal <code class="docutils literal notranslate"><span class="pre">SIGINFO</span></code> permettant de visualiser certaines informations liées à l'exécution du processus.</p></li>
</ul>
<p>Si le programme suivant est exécuté, il sera bloquant, c'est-à-dire qu'à moins d'envoyer un signal d'interruption, il ne sera pas possible d'interrompre le processus :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(;;);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="arguments-et-options">
<h2><span class="section-number">8.2  </span>Arguments et options<a class="headerlink" href="#arguments-et-options" title="Lien permanent vers ce titre">¶</a></h2>
<p>L'interpréteur de commande <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code> sous Windows ou <code class="docutils literal notranslate"><span class="pre">bash</span></code> sous Linux, fonctionne de façon assez similaire. L'<strong>invite de commande</strong> nommée <em>prompt</em> en anglais invite l'utilisateur à entrer une commande. Sous <a class="reference external" href="https://fr.wikipedia.org/wiki/DOS">DOS</a> puis sous Windows cet invite de commande ressemble à ceci :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">C:\&gt;</span>
</pre></div>
</div>
<p>Sous Linux, le prompt est largement configurable et dépend de la distribution installée, mais le plus souvent il se termine par le caractère <code class="docutils literal notranslate"><span class="pre">$</span></code> ou <code class="docutils literal notranslate"><span class="pre">#</span></code>.</p>
<p>Une commande débute par le nom de cette dernière, qui peut être le nom du programme que l'on souhaite exécuter puis vient les arguments et les options.</p>
<ul class="simple">
<li><p>Une <strong>option</strong> est par convention un <strong>argument</strong> dont le préfixe est <code class="docutils literal notranslate"><span class="pre">-</span></code> sous Linux ou <code class="docutils literal notranslate"><span class="pre">/</span></code> sous Windows même si le standard GNU gagne du terrain. Aussi, le consensus le plus large semble être le suivant :</p></li>
<li><p>Une option peut être exprimée soit sous format court <code class="docutils literal notranslate"><span class="pre">-o</span></code>, <code class="docutils literal notranslate"><span class="pre">-v</span></code>, soit sous format long <code class="docutils literal notranslate"><span class="pre">--output=</span></code>, <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> selon qu'elle commence par un ou deux tirets. Une option peut être un booléenne (présence ou non de l'option), ou scalaire, c'est-à-dire être associée à une valeur <code class="docutils literal notranslate"><span class="pre">--output=foo.o</span></code>. Les options modifient le comportement interne d'un programme.</p></li>
</ul>
<p>Un argument est une chaîne de caractères utilisée comme entrée au programme. Un programme peut avoir plusieurs arguments.</p>
<p>En C, c'est au développeur de distinguer les options des arguments, car ils sont tous passés par le paramètre <code class="docutils literal notranslate"><span class="pre">argv</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Liste des arguments et options passés au programme:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">argc</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  %u. %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>argverbose --help -h<span class="o">=</span><span class="m">12</span> <span class="m">3</span>.14 <span class="s1">&#39;Baguette au beurre&#39;</span> <span class="s1">$&#39;\t-Lait\n\t-Viande\n\t-Oeufs\f&#39;</span>
<span class="go">Liste des arguments et options passés au programme :</span>
<span class="go">0. ./a.out</span>
<span class="go">1. --help</span>
<span class="go">2. -h=12</span>
<span class="go">3. 3.14</span>
<span class="go">4. Baguette au beurre</span>
<span class="go">5.  -Lait</span>
<span class="go">    -Viande</span>
<span class="go">    -Oeufs</span>
</pre></div>
</div>
<div class="section" id="norme-posix">
<h3><span class="section-number">8.2.1  </span>Norme POSIX<a class="headerlink" href="#norme-posix" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le standard POSIX décrit une façon de distinguer des <em>options</em> passées à un programme. Par exemple, le programme <a class="reference external" href="https://en.wikipedia.org/wiki/Cowsay">cowsay</a> peut être paramétré pour changer son comportement en utilisant des <cite>options</cite> standards comme <code class="docutils literal notranslate"><span class="pre">-d</span></code>. La fonction <code class="docutils literal notranslate"><span class="pre">getopt</span></code> disponible dans la bibliothèque <code class="docutils literal notranslate"><span class="pre">&lt;unistd.h&gt;</span></code> permet de facilement interpréter ces options.</p>
</div>
<div class="section" id="extension-gnu">
<h3><span class="section-number">8.2.2  </span>Extension GNU<a class="headerlink" href="#extension-gnu" title="Lien permanent vers ce titre">¶</a></h3>
<p>Malheureusement, la norme POSIX ne spécifie que les options dites courtes (un tiret suivi d'un seul caractère). Une extension <a class="reference external" href="https://fr.wikipedia.org/wiki/GNU">GNU</a> et son en-tête <code class="docutils literal notranslate"><span class="pre">&lt;getopt.h&gt;</span></code> permet l'accès à la fonction <code class="docutils literal notranslate"><span class="pre">getopt_long</span></code> laquelle permet d'interpréter aussi les options longues <code class="docutils literal notranslate"><span class="pre">--version</span></code> qui sont devenues très répandue.</p>
<p>Ci-dessous une possible utilisation de cette fonction :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;getopt.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Options</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_verbose</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">has_add</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">has_append</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">has_delete</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">has_create</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">create_name</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">delete_name</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">file_name</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">Options</span><span class="p">;</span><span class="w"></span>

<span class="n">Options</span><span class="w"> </span><span class="nf">parse_options</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Options</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">verbose_flag</span><span class="p">;</span><span class="w">  </span><span class="c1">// Set by --verbose/--brief</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">option</span><span class="w"> </span><span class="n">long_options</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// These options set a flag.</span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;verbose&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">no_argument</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">verbose_flag</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;brief&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">no_argument</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">verbose_flag</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"></span>

<span class="w">            </span><span class="c1">// These options don’t set a flag. We distinguish them by their</span>
<span class="w">            </span><span class="c1">// indices.</span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;add&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">no_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;append&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">no_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;b&#39;</span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;delete&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;d&#39;</span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;file&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">required_argument</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;f&#39;</span><span class="p">},</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Sentinel marking the end of the structure.</span>
<span class="w">            </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}};</span><span class="w"></span>

<span class="w">        </span><span class="c1">// getopt_long stores the option index here.</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">option_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getopt_long</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;abc:d:f:&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">long_options</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">option_index</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Detect the end of the options.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                </span><span class="n">options</span><span class="p">.</span><span class="n">has_add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;b&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                </span><span class="n">options</span><span class="p">.</span><span class="n">has_append</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                </span><span class="n">options</span><span class="p">.</span><span class="n">create_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optarg</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;d&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                </span><span class="n">options</span><span class="p">.</span><span class="n">delete_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optarg</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;f&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                </span><span class="n">options</span><span class="p">.</span><span class="n">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optarg</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;?&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">                </span><span class="c1">// getopt_long already printed an error message.</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">                </span><span class="n">abort</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">is_verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verbose_flag</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Parses the remaining command line arguments if got any</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">optind</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">argc</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">optind</span><span class="o">++</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">options</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Options</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_options</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="windows">
<h3><span class="section-number">8.2.3  </span>Windows<a class="headerlink" href="#windows" title="Lien permanent vers ce titre">¶</a></h3>
<p>Windows utilise à l'instar de <code class="docutils literal notranslate"><span class="pre">RDOS</span></code> ou <a class="reference external" href="https://en.wikipedia.org/wiki/OpenVMS">OpenVMS</a>, le caractère <em>slash</em> pour identifier ses options. Alors que sous POSIX l'affichage de la liste des fichiers s'écrira peut-être <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">-s</span> <span class="pre">D*</span></code>, sous Windows on utilisera <code class="docutils literal notranslate"><span class="pre">dir</span> <span class="pre">/q</span> <span class="pre">d*</span> <span class="pre">/o:s</span></code>.</p>
</div>
</div>
<div class="section" id="fonction-main">
<h2><span class="section-number">8.3  </span>Fonction main<a class="headerlink" href="#fonction-main" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le standard définit une fonction nommée <code class="docutils literal notranslate"><span class="pre">main</span></code> comme étant la fonction principale appelée à l'exécution du programme. Or, sur un système d'exploitation, la fonction <code class="docutils literal notranslate"><span class="pre">main</span></code> a déjà été appelée il y a belle lurette lorsque l'ordinateur a été allumé et que le <a class="reference external" href="https://en.wikipedia.org/wiki/BIOS">BIOS</a> a chargé le système d'exploitation en mémoire. Dès lors la fonction <code class="docutils literal notranslate"><span class="pre">main</span></code> de notre programme <a class="reference external" href="hello">Hello World</a> n'est pas la première, mais est appelé.</p>
<div class="section" id="qui-appelle-main">
<h3><span class="section-number">8.3.1  </span>Qui appelle main ?<a class="headerlink" href="#qui-appelle-main" title="Lien permanent vers ce titre">¶</a></h3>
<p>Un exécutable binaire à un format particulier appelé <strong>ELF</strong> (<a class="reference external" href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">Executable and Linkable Format</a>) qui contient un <strong>point d'entrée</strong> qui sera l'adresse mémoire de début du programme. Sous un système POSIX ce point d'entrée est nommé <code class="docutils literal notranslate"><span class="pre">_init</span></code>. C'est lui qui est responsable de récolter les informations transmises par le système d'exploitation. Ce dernier transmet sur la <strong>pile</strong> du programme :</p>
<ul class="simple">
<li><p>Le nombre d'arguments <code class="docutils literal notranslate"><span class="pre">argc</span></code></p></li>
<li><p>La liste des arguments <code class="docutils literal notranslate"><span class="pre">argv</span></code></p></li>
<li><p>Les variables d'environnements <code class="docutils literal notranslate"><span class="pre">envp</span></code></p></li>
<li><p>Les pointeurs de fichiers sur <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, <code class="docutils literal notranslate"><span class="pre">stdin</span></code>, <code class="docutils literal notranslate"><span class="pre">stderr</span></code></p></li>
</ul>
<p>C'est la fonction <code class="docutils literal notranslate"><span class="pre">__libc_start_main</span></code> de la bibliothèque standard qui a la responsabilité d'appeler la fonction <code class="docutils literal notranslate"><span class="pre">main</span></code>. Voici son prototype :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">__libc_start_main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">main</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">ubp_av</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)(</span><span class="kt">void</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fini</span><span class="p">)(</span><span class="kt">void</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">rtld_fini</span><span class="p">)(</span><span class="kt">void</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">stack_end</span><span class="p">)</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="valeur-de-retour">
<h3><span class="section-number">8.3.2  </span>Valeur de retour<a class="headerlink" href="#valeur-de-retour" title="Lien permanent vers ce titre">¶</a></h3>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">main</span></code> renvoie toujours une valeur de retour qui agit comme le statut de sortie d'un programme (<a class="reference external" href="https://en.wikipedia.org/wiki/Exit_status">exit status</a>). Sous POSIX et sous Windows, le programme parent s'attend à recevoir une valeur 32-bits à la fin de l'exécution d'un programme. L'interprétation est la suivante :</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">0</span></code></dt><dd><p>Succès, le programme s'est terminé correctement.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">!0</span></code></dt><dd><p>Erreur, le programme ne s'est pas terminé correctement.</p>
</dd>
</dl>
<p>Par exemple le programme <code class="docutils literal notranslate"><span class="pre">printf</span></code> retourne dans le cas précis l'erreur 130 :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">printf</span> <span class="s1">&#39;%d&#39;</span> <span class="m">42</span>
<span class="go">42</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
<span class="go">0</span>

<span class="gp">$ </span><span class="nb">printf</span> <span class="s1">&#39;%d&#39;</span> <span class="s1">&#39;I am not a number&#39;</span>
<span class="go">printf: I am not a number: invalid number</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
<span class="go">130</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="entrees-sorties-standards">
<h2><span class="section-number">8.4  </span>Entrées sorties standards<a class="headerlink" href="#entrees-sorties-standards" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le fichier d'en-tête <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code> (<a class="reference external" href="http://man7.org/linux/man-pages/man3/stdio.3.html">man stdio</a>) permet de simplifier l'interaction avec les fichiers. Sous Linux et MacOS principalement, mais d'une certaine manière également sous Windows, les canaux d'échanges entre un programme et son hôte (<em>shell</em>, gestionnaire de fenêtre, autre programme), se font par l'intermédiaire de fichiers particuliers nommés <code class="docutils literal notranslate"><span class="pre">stdin</span></code>, <code class="docutils literal notranslate"><span class="pre">stdout</span></code> et <code class="docutils literal notranslate"><span class="pre">stderr</span></code>.</p>
<p>La fonction de base est <code class="docutils literal notranslate"><span class="pre">putchar</span></code> qui écrit un caractère sur <code class="docutils literal notranslate"><span class="pre">stdout</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>include &lt;stdio.h&gt;

<span class="go">int main(void) {</span>
<span class="go">    putchar(&#39;H&#39;);</span>
<span class="go">    putchar(&#39;e&#39;);</span>
<span class="go">    putchar(&#39;l&#39;);</span>
<span class="go">    putchar(&#39;l&#39;);</span>
<span class="go">    putchar(&#39;o&#39;);</span>
<span class="go">    putchar(&#39;\n&#39;);</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Bien vite, on préfèrera utiliser <code class="docutils literal notranslate"><span class="pre">printf</span></code> qui simplifie le formatage de chaînes de caractères et qui permet à l'aide de marqueurs (<em>tokens</em>) de formater des variables :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello</span><span class="se">\v</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d, %s, %f&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World!&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">3.1415</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Il peut être nécessaire, surtout lorsqu'il s'agit d'erreurs qui ne concernent pas la sortie standard du programme, d'utiliser le bon canal de communication, c'est-à-dire <code class="docutils literal notranslate"><span class="pre">stderr</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">stdout</span></code>. La fonction <code class="docutils literal notranslate"><span class="pre">fprintf</span></code> permet de spécifier le flux standard de sortie :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sortie standard</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sortie d&#39;erreur standard</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Pourquoi, me direz-vous, faut-il séparer la sortie standard du canal d'erreur? Le plus souvent un programme n'est pas utilisé seul, mais en conjonction avec d'autres programmes :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span> <span class="s2">&quot;Bonjour&quot;</span> <span class="p">|</span> tr <span class="s1">&#39;A-Za-z&#39;</span> <span class="s1">&#39;N-ZA-Mn-za-m&#39;</span> &gt; data.txt
<span class="gp">$ </span>cat data.txt
<span class="go">Obawbhe</span>
</pre></div>
</div>
<p>Dans cet exemple ci-dessus le programme <code class="docutils literal notranslate"><span class="pre">echo</span></code> prends en argument la chaîne de caractère <code class="docutils literal notranslate"><span class="pre">Bonjour</span></code> qu'il envoie sur la sortie standard. Ce flux de sortie est relié au flux d'entrée du programme <code class="docutils literal notranslate"><span class="pre">tr</span></code> qui effectue une opération de <a class="reference external" href="https://fr.wikipedia.org/wiki/ROT13">ROT13</a> et envoie le résultat sur la sortie standard. Ce flux est ensuite redirigé sur le fichier <code class="docutils literal notranslate"><span class="pre">data.txt</span></code>.
La commande suivante <code class="docutils literal notranslate"><span class="pre">cat</span></code> lis le contenu du fichier dont le nom est passé en argument et écrit le contenu sur la sortie standard.</p>
<p>Dans le cas où un de ces programmes génère une alerte (<em>warning</em>), le texte ne sera pas transmis le long de la chaîne, mais simplement affiché sur la console. Il est donc une bonne pratique que d'utiliser le bon flux de sortie: <code class="docutils literal notranslate"><span class="pre">stdout</span></code> pour la sortie standard et <code class="docutils literal notranslate"><span class="pre">stderr</span></code> pour les messages de diagnostique et les erreurs.</p>
</div>
<div class="section" id="boucle-d-attente">
<h2><span class="section-number">8.5  </span>Boucle d'attente<a class="headerlink" href="#boucle-d-attente" title="Lien permanent vers ce titre">¶</a></h2>
<p>Comme évoqué, un programme est souvent destiné à tourner sur un système d'exploitation. Un programme simple comme celui-ci :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(;;)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>consommera 100% des ressources du processeur. En d'autres termes, le processeur dépensera toute son énergie à faire 150 millions de calculs par seconde, pour rien. Et les autres processus n'auront que très peu de ressources disponibles pour tourner.</p>
<p>Il est grandement préférable d'utiliser des appels système pour indiquer au noyau du système d'exploitation que le processus souhaite être mis en pause pour un temps donné. Le programme suivant utilise la fonction standard <code class="docutils literal notranslate"><span class="pre">sleep</span></code> pour demander au noyau d'être mis en attente pour une période de temps spécifiée en paramètre.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="cm">/* seconds */</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Alternativement, lorsqu'un programme attend un retour de l'utilisateur par exemple en demandant la saisie au clavier d'informations, le système d'exploitation est également mis en attente et le processus ne consomme pas de ressources CPU. Le programme ci-dessous attend que l'utilisateur presse la touche enter.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">getchar</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Vous avez pressé la touche enter (</span><span class="se">\\</span><span class="s">n)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div>
<p class="rubric">Exercice 8.1<a class="headerlink" href="#exercise-0" title="Permalink to this rubric">¶</a></p>
<p>En rappelant l'historique des dernières commandes exécutées sur l'ordinateur du professeur pendant qu'il avait le dos tourné, vous tombez sur cette commande :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>fortune <span class="p">|</span> cowsay <span class="p">|</span> lolcat
</pre></div>
</div>
<p>Quelle est sa structure et que fait-elle ?</p>
</div>
</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="control-structures.html"
       title="Chapitre précédent">← <span class="section-number">7  </span>Structures de contrôle</a>
  </li>
  <li class="next">
    <a href="stdio.html"
       title="Chapitre suivant"><span class="section-number">9  </span>Entrées Sorties →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright HEIG-VD(c) 2022.
    Mis à jour le 18 févr. 2022 (version v0.3.0-31-gcddb9f1).
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1 with <a href="https://github.com/heig-vd-tin/sphinx_heigvd_theme">HEIG-VD Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>